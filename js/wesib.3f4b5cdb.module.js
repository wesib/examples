import{S as e,F as t,v as n,C as s,a as r,b as o,n as i,c as a,t as c,d as u,e as h,f as l,g as d,h as f,i as p,j as g,k as m,l as w,A as y,D as _,E as b,m as v,o as x,p as S,q as E,r as O,s as D,u as C,w as k,O as R,x as j,y as T,z as P,B as q,G as A,H as M,I as L,J as U,K as N,L as z,M as B,N as V,P as I,Q as $,R as F,T as H,U as Q,V as G,W as J,X as K,Y as W,Z as X}from"./lib.a89aa200.module.js";const Y=new e("bootstrap-context");class Z extends o{static get[r](){return Y}}function ee(e){return(t,n)=>{const s=t.get(Z);return t===s?e(s,n):s.get(n)}}const te=new e("component-factory");class ne{static get[r](){return te}connectTo(e){const t=this.mountTo(e);return t.connected=!0,t}}const se=new e("window",{byDefault:()=>window}),re=(new e("bootstrap-root",{byDefault:e=>e.get(se).document.body}),new e("default-namespace-aliaser"));function oe(e){return Array.isArray(e)}class ie extends y{constructor(e){super(),this.items=null==e?new Set:oe(e)?new Set(e):new Set([e])}get value(){switch(this.items.size){case 0:return;case 1:return this.items[Symbol.iterator]().next().value;default:return[...this.items]}}[Symbol.iterator](){return this.items[Symbol.iterator]()}add(...e){return e.forEach(e=>this.items.add(e)),this}get size(){return this.items.size}merge(e){return null==e?this:oe(e)?this.add(...e):this.add(e)}}function ae(e,t,n=((e,t)=>t)){return e?t?function(...s){return n(e.apply(this,s),t.apply(this,s))}:e:t}class ce{constructor(e){this.symbol=e}of(e){const t=e[this.symbol],n=function e(t,n=(()=>!0)){const s=Object.getPrototypeOf(t.prototype);if(null==s)return;const r=s.constructor;return n(r)?r:e(r,n)}(e,e=>this.symbol in e),s=n&&this.of(n);if(t)return s&&s!==t?this.merge(s,t):t}define(e,...t){const n=this.of(e);let s;return s=n?this.merge(n,...t):this.merge(...t),Object.defineProperty(e,this.symbol,{configurable:!0,value:s}),e}}class ue{constructor(){this.promise=new Promise((e,t)=>{this._resolve=e,this._reject=t})}resolve(e){this._resolve(e)}reject(e){this._reject(e)}}const he=Symbol("feature-def");class le extends ce{constructor(){super(he)}merge(...e){return e.reduce((e,t)=>({set:new ie(e.set).merge(t.set).value,needs:new ie(e.needs).merge(t.needs).value,has:new ie(e.has).merge(t.has).value,init:ae(e.init,t.init),perDefinition:new ie(e.perDefinition).merge(t.perDefinition).value,perComponent:new ie(e.perComponent).merge(t.perComponent).value}),{})}}const de=new le,fe={of:e=>de.of(e)||{},merge:(...e)=>de.merge(...e),define:(e,...t)=>de.define(e,...t)};function pe(e){return t=>fe.define(t,e)}const ge=new e("feature-context");class me extends Z{static get[r](){return ge}get onDefinition(){return this.get(Z).onDefinition}get onComponent(){return this.get(Z).onComponent}whenDefined(e){return this.get(Z).whenDefined(e)}load(e){return this.get(Z).load(e)}}class we extends Error{constructor(e){super("Circular feature needs: "+e.reduce((e,[t,n,s])=>(e||t.name)+` ${n} ${s.name}`,"")),this.needs=e}}const ye=Symbol("component-def");class _e extends ce{constructor(){super(ye)}merge(...e){return e.reduce((e,t)=>Object.assign(Object.assign(Object.assign({},e),t),{set:new ie(e.set).merge(t.set).value,define:ae(e.define,t.define),perComponent:new ie(e.perComponent).merge(t.perComponent).value,feature:e.feature?t.feature?fe.merge(e.feature,t.feature):e.feature:t.feature}),{})}}const be=new _e,ve={of:e=>be.of(e)||{},merge:(...e)=>be.merge(...e),define(e,...t){const n=this.merge(...t),s=be.of(e);be.define(e,n);const{feature:r}=n;return r&&fe.define(e,r),s?e:fe.define(e,{init:function(e){e.define(this)}})}};function xe(e){return t=>ve.define(t,"string"==typeof e?{name:e}:e)}const Se=new e("component-context"),Ee=new e("component-event-dispatcher",{byDefault:()=>({dispatch:(e,t)=>e.element.dispatchEvent(t),on:(e,t)=>new _(e.element).on(t)})}),Oe=new e("content-root",{byDefault:e=>e.get(Se).element}),De=new t("state-updater",{byDefault:n(i)}),Ce=Symbol("component-context");class ke extends o{constructor(){super(...arguments),this.updateState=Re.bind(this)}static get[r](){return Se}static of(e){const t=e[Ce];if(!t)throw TypeError(`No component context found in ${e}`);return t}get contentRoot(){return this.get(Oe)}on(e){return this.get(Ee).on(this,e)}dispatchEvent(e){this.get(Y).get(Ee).dispatch(this,e)}}function Re(e,t,n){this.get(De)(e,t,n)}class je extends Event{constructor(e,t){super(e,t)}get context(){return ke.of(this.target)}}class Te{get component(){return this.context.component}get element(){return this.context.element}}const Pe=new class extends a{constructor(){super("element-adapter")}grow(e){const t=e=>e[Ce];let n;return e.seed((...s)=>{const r=s.reduce((e,t)=>n=>e(n)||t(n),t);n=r!==t?r:e.byDefault(()=>t)||t}),e=>n(e)}},qe=Symbol("component-factory");function Ae(e){const t=e[qe];if(!t)throw new TypeError(`Component is not defined: ${e}`);return t}const Me=new e("custom-elements",{byDefault:function(e){const t=e.get(se).customElements,n=e.get(re);return new class extends Le{define(e,s){if(E(e))return void t.define(O.name(e,n),s);const r=Ae(e),{name:o,extend:i}=r.elementDef;o?i&&i.name?t.define(O.name(o,n),s,{extends:i.name}):t.define(O.name(o,n),s):Ne(e).resolve(void 0)}whenDefined(e){if(E(e))return t.whenDefined(O.name(e,n));const s=Ae(e),{name:r}=s.elementDef;return r?t.whenDefined(O.name(r,n)):Ne(e).promise}}}});class Le{static get[r](){return Me}}const Ue=Symbol("component-resolver");function Ne(e){return e[Ue]||(e[Ue]=new ue)}const ze=new e("definition-context"),Be=new e("element-def",{byDefault(e){const t=e.get(ze).componentType,{name:n,extend:s}=ve.of(t),r={get type(){return s&&s.type||e.get(se).HTMLElement},get name(){return s&&s.name}};return{get name(){return n},get extend(){return r}}}});class Ve extends o{static get[r](){return ze}get elementDef(){return this.get(Be)}}const Ie=new e("bootstrap-value-registry");class $e extends s{constructor(){super(),this.provide({a:$e,is:this}),this.values=this.newValues()}static get[r](){return Ie}static create(){return new $e}}const Fe=new e("component-value-registry",{byDefault:ee(()=>new He)});class He extends s{static get[r](){return Fe}constructor(e){super(e)}}const Qe=new e("definition-value-registry",{byDefault:ee(e=>new Ge(e))});class Ge extends s{static get[r](){return Qe}constructor(e){super(e)}}const Je=Symbol("component-status");function Ke(e){return e[Je]}const We=new e("element-builder",{byDefault:ee(e=>new Xe(e))});class Xe{constructor(e){this.definitions=new b,this.components=new b,this._definitionValueRegistry=e.get(Ge),this._componentValueRegistry=e.get(He)}static get[r](){return We}buildElement(e){const t=ve.of(e),n=this,s=new b;let r;const o=c(!1),i=o.read.thru(e=>e?u():h());let a;function l(){return n._componentValueRegistry.append(r)}const d=new class extends ne{get componentType(){return a.componentType}get elementType(){return a.elementType}get elementDef(){return a.elementDef}mountTo(e){if(e[Ce])throw new Error(`Element ${e} already bound to component`);const t=n._createComponent({definitionContext:a,onComponent:s,valueRegistry:l(),element:e,elementSuper:t=>e[t],createMount:t=>new class extends Te{get context(){return t}get connected(){return 3===Ke(e).it}set connected(t){Ke(e).it=t?3:2}checkConnected(){const t=e,n=t.ownerDocument;return this.connected=null!=n&&n.contains(t)}}}).mount;return t.checkConnected(),Ye(t.context),t}};a=new class extends Ve{constructor(){super();const e=new Ge(n._definitionValueRegistry.seedIn(this));e.provide({a:Ve,is:this}),e.provide({a:ne,is:d}),this.get=e.newValues().get,new ie(t.set).forEach(t=>e.provide(t)),r=new He(e.seedIn(this)),new ie(t.perComponent).forEach(e=>r.provide(e))}get componentType(){return e}get onComponent(){return s.on}get elementType(){throw new Error("Custom element class is not constructed yet. Consider to use a `whenReady()` callback")}whenReady(e){i.once(()=>e(this.elementType))}perComponent(e){r.provide(e)}},t.define&&t.define.call(e,a),this.definitions.send(a);const f=this._elementType(a,s,l());return Object.defineProperty(a,"elementType",{configurable:!0,enumerable:!0,value:f}),o.it=!0,d}_elementType(e,t,n){const s=this,r=e.get(Be);class o extends r.extend.type{constructor(){super(),Ye(s._createComponent({definitionContext:e,onComponent:t,valueRegistry:n,element:this,createMount:i,elementSuper:e=>super[e]}))}connectedCallback(){Ke(this).it=3}disconnectedCallback(){Ke(this).it=2}}return o}_createComponent({definitionContext:e,onComponent:t,valueRegistry:n,element:s,createMount:r,elementSuper:o}){const a=c(0),l=a.on(i),d=a.read.thru(e=>e?u():h()),f=a.read.thru(e=>2===e?u():h()),p=a.read.thru(e=>{if(3!==e)return h();const t=v();return f.once(()=>t.off()),u(t)});let g;const m=n.newValues();const w=new class extends ke{constructor(){super(...arguments),this.get=m.get,this.elementSuper=o}get componentType(){return e.componentType}get element(){return s}get component(){throw new Error("The component is not constructed yet. Consider to use a `whenReady()` callback")}get mount(){return g||(g=r(this))}get connected(){return 3===a.it}get whenOn(){return p}get whenOff(){return f}whenReady(e){d.once(()=>e(this.component))}whenDestroyed(e){l.whenOff(e)}destroy(e){a.done(e)}};w.whenDestroyed(()=>(function(e){const{element:t,mount:n}=e;n&&(n.connected=!1);const s=t.parentElement;s&&s.removeChild(t)})(w)),n.provide({a:ke,is:w}),Object.defineProperty(s,Ce,{value:w}),Object.defineProperty(s,Je,{writable:!0,value:a}),this.components.send(w),t.send(w);const y=function(e,t){const n=e.prototype,s=n[Ce];n[Ce]=t;try{const r=new e(t);return Object.defineProperty(r,Ce,{value:t}),r}finally{n[Ce]=s}}(e.componentType,w);return Object.defineProperty(w,"component",{configurable:!0,enumerable:!0,value:y}),a.it=1,w}}function Ye(e){e.dispatchEvent(new je("wesib:component",{bubbles:!0}))}class Ze{constructor(e){this._context=e,this._definitionQueue=[],e.whenReady(()=>{this._definitionQueue.forEach(e=>e()),delete this._definitionQueue})}get customElements(){return this._context.get(Le)}define(e){this._definitionQueue.push(()=>{const t=this._context.get(Xe).buildElement(e);e[qe]=t,this.customElements.define(e,t.elementType)})}}const et=Symbol("feature-key");class tt extends a{static of(e){const t=e;return t[et]||(t[et]=new tt(e))}constructor(e){super(`feature:${e.name}`)}grow(e){return t=e.context.get(Z),n=e.seed.keep.thru(nt),l(e=>{let s,r=d(),o=Promise.resolve("idle");return f({clause:n,deps:st(t,n)}).dig_(({clause:[e],deps:n})=>{if(!e)return d();const[i,,a]=e;if(i.feature===s)return r;if(s=i.feature,a!==s)return r=t.get(tt.of(s)).thru_(e=>(e.to(o),o=e.stage,e));const c=new ot(t,i,n).to(o),u=d(c);return r=l(e=>u(e).whenOff(()=>{o=c.unload()})).share()})(e)}).keep.thru(function(){let e=null;return t=>e===t?h():(e=t,t?u(t):u())}());var t,n}}function nt(...e){let t,n=!1;for(const s of e)switch(s[1]){case"is":n=!0,t||(t=s);break;case"has":t=s;break;case"needs":n=!0}return n?t:void 0}function st(e,t){return t.keep.dig_(t=>{if(!t)return d();const[{def:n}]=t,s=new ie(n.needs);return s.size?p(...s.map(t=>e.get(tt.of(t)))).keep.thru_(rt):d()})}function rt(...e){return u(...g(x(e,e=>e[0]),S))}class ot{constructor(e,t,n){this.bsContext=e,this.request=t,this.deps=n,this.state=c(!1),this.down=new Promise(e=>this._down=e),this._stage=Promise.resolve(new at(this))}get stage(){return this._stage.then(e=>e.after)}get ready(){return this.state.it}to(e){const t=this._stage;return this._stage=e.then(e=>t.then(t=>t[e]())),this}async setup(){await(this._stage=this._stage.then(e=>e.setup()))}async init(){await(this._stage=this._stage.then(e=>e.init()))}async unload(){const e=this._stage;delete this._stage;const t=await e,n=await t.stop();return this._down(),n}}class it{constructor(e,t=(()=>Promise.resolve())){this.loader=e,this._stop=t}async idle(){return this}stop(){return this._stop().then(()=>this.after)}perDep(e){const{deps:t}=this.loader;return Promise.all(t.map(t=>e(t)))}}class at extends it{get after(){return"idle"}async setup(){await this.perDep(e=>e.setup());const{bsContext:e,request:{def:{set:t,perDefinition:n,perComponent:r}}}=this.loader,[o,i]=function(e,t){const n=[];let r;const o=e.get(Ge),i=e.get(He),a=new s(e),c=t.state.read.thru(e=>e?u():h());return[new class extends me{constructor(){super(),this.get=a.newValues().get,a.provide({a:me,is:this}),r=new Ze(this)}perDefinition(e){const t=o.provide(e);return n.push(t),t}perComponent(e){const t=i.provide(e);return n.push(t),t}define(e){r.define(e)}whenReady(t){e.whenReady(()=>{c.once(t)})}},n]}(e,this.loader),a=e.get($e);return new ie(t).forEach(e=>i.push(a.provide(e))),new ie(n).forEach(e=>o.perDefinition(e)),new ie(r).forEach(e=>o.perComponent(e)),new ct(this.loader,o,async()=>i.forEach(e=>e()))}init(){return this.setup().then(e=>e.init())}}class ct extends it{constructor(e,t,n){super(e,n),this._context=t}get after(){return"setup"}async setup(){return this}async init(){await this.perDep(e=>e.init());const{request:{feature:e,def:{init:t}}}=this.loader;return t&&t.call(e,this._context),new ut(this)}}class ut extends it{get after(){return"init"}constructor(e){super(e.loader,()=>e.stop()),e.loader.state.it=!0}async setup(){return this}async init(){return this}}class ht{constructor(e,t){this._requester=e,this.feature=t,this._uses=0,this._revoke=i,this.def=fe.of(t)}request(e){const t=this._requester,{registry:n}=t,s=[this,"is",this.feature];return this._revokeBy(n.provide({a:tt.of(this.feature),is:s})),new ie(this.def.has).forEach(s=>{const r=[this,"has",s];this._revokeBy(n.provide({a:tt.of(s),is:r}));const o=t.request(s,[...e,r]);this._revokeBy(()=>o.unuse())}),new ie(this.def.needs).forEach(s=>{const r=[this,"needs",s],o=t.request(s,[...e,r]);this._revokeBy(()=>o.unuse()),this._revokeBy(n.provide({a:tt.of(s),is:r}))}),this._uses=1,this}reuse(e){if(!this._uses)throw new we(e.map(([{feature:e},t,n])=>[e,t,n]));return++this._uses,this}unuse(){--this._uses||this._revoke()}_revokeBy(e){this._revoke=ae(e,this._revoke)}}const lt=new e("feature-requester",{byDefault:ee(e=>new dt(e))});class dt{constructor(e){this._map=new Map,this.registry=e.get($e)}static get[r](){return lt}request(e,t=[]){const n=this._map.get(e);if(n)return n.reuse(t);const s=new ht(this,e);return this._map.set(e,s),s.request(t)}}function ft(...e){const t=$e.create(),{bootstrapContext:n,complete:s}=function(e){const t=c(0),n=t.read.thru(e=>e?u():h()),s=e.values;const r=new class extends Z{constructor(){super(),this.get=s.get,e.provide({a:re,by:m}),e.provide({a:Z,is:this})}get onDefinition(){return this.get(Xe).definitions.on}get onComponent(){return this.get(Xe).components.on}async whenDefined(e){return await new Promise(e=>this.whenReady(e)),await this.get(Le).whenDefined(e),Ae(e)}whenReady(e){n.once(e)}load(e){return l(t=>{const n=r.get(dt).request(e),s=c({feature:e,ready:!1});this.get(tt.of(e))({supply:t.supply,receive(e,t){const n=t;s.it={feature:n.request.feature,ready:n.ready},n.ready||n.init().then(()=>{s.it={feature:n.request.feature,ready:!0}})}}).whenOff(()=>{n.unuse()}),s.read(t)}).share()}};return{bootstrapContext:r,complete(){t.it=1}}}(t),r=1===e.length?e[0]:(o=e,fe.define(class{},{needs:o}));var o;return n.get(dt).request(r),n.get(tt.of(r))(e=>{e.init().then(s)}),n}const pt=Symbol("attribute");function gt(e,t=!0){if(!1===t)return i;if(!0===t||"function"==typeof t){const n=function(e){return[pt,e]}(e),s=!0===t?mt:t;return function(e,t){s.call(this,n,e,t)}}return function(e,n){ke.of(this).updateState(t,e,n)}}function mt(e,t,n){ke.of(this).updateState(e,t,n)}const wt=new e("attribute-registrar"),yt=new e("attribute-registry");class _t{constructor(e){this._attrs={},this._MutationObserver=e.get(se).MutationObserver}static get[r](){return yt}add(e,t){this._attrs[e]=ae(this._attrs[e],t)}define(e){const t=this._attrs,n=Object.keys(t);n.length&&(Object.defineProperty(e,"observedAttributes",{configurable:!0,enumerable:!0,value:n}),Object.defineProperty(e.prototype,"attributeChangedCallback",{configurable:!0,enumerable:!0,value:function(e,n,s){t[e].call(ke.of(this).component,s,n)}}))}mount(e){const t=e.element,n=this._attrs,s=Object.keys(n);s.length&&new this._MutationObserver(e=>e.forEach(e=>{const s=e.attributeName;return n[s].call(ke.of(t).component,t.getAttribute(s),e.oldValue)})).observe(t,{attributes:!0,attributeFilter:s,attributeOldValue:!0})}}const bt={perDefinition:[{as:_t},{a:wt,by:e=>(t,n)=>e.add(t,n),with:[_t]}],init(e){e.onDefinition(e=>{e.whenReady(t=>e.get(_t).define(t))}),e.onComponent(e=>{const t=e.mount;t&&e.get(_t).mount(t)})}};class vt{static get[he](){return bt}}function xt(e){return(t,n,s)=>{const{name:r,updateState:o}=function(e,t,n){let s,r;if("string"==typeof n)s=n,r=gt(s);else{if(n&&n.name)s=n.name;else{if("string"!=typeof t)throw new TypeError("Attribute name is required, as property key is not a string: "+`${e.constructor.name}.${t.toString()}`);s=t}r=gt(s,n&&n.updateState)}return{name:s,updateState:r}}(t,n,e),i=t.constructor;fe.define(i,{needs:vt}),ve.define(i,{define(e){e.get(wt)(r,o)}});const a={get(){return ke.of(this).element.getAttribute(r)},set(e){ke.of(this).element.setAttribute(r,e)}};if(null!=s)return a;Object.defineProperty(t,n,a)}}const St=Symbol("dom-property");const Et=new e("component-state");class Ot extends w{static get[r](){return Et}}const Dt={perComponent:[{a:Ot,by(e){const t=new Ot;return e.whenDestroyed(e=>t.done(e)),t}},{a:De,by:e=>e.update,with:[Ot]}]};class Ct{static get[he](){return Dt}}const kt=new e("render-scheduler");class Rt{static get[r](){return kt}}const jt={render(e,t,n={}){const s=e.get(Ot),r=e.get(Rt).newSchedule(),{offline:o}=n;let i=!1;const a=s.onUpdate(()=>{o||e.connected?c():i=!1});function c(){i=!0,r.schedule(u)}function u(){for(;;){const e=t();if(e===t||"function"!=typeof e)break;t=e}}o?c():e.whenOn(()=>{i||c()}).whenOff(e=>{a.off(e),i=!0})}},Tt={set:{a:Rt,by:function(e){return new class extends Rt{newSchedule(){let t=i;return new class{schedule(n){const s=t;t=n,s===i&&e.requestAnimationFrame(()=>{t(),t=i})}}}}},with:[se]}};class Pt{static get[he](){return Tt}}function qt(e){return(t,n)=>{const s=t.constructor;ve.define(s,{define(t){t.onComponent(t=>{t.whenReady(()=>{const s=t.component,r=s[n].bind(s);jt.render(t,r,e)})})},feature:{needs:[Ct,Pt]}})}}const At=new e("shadow-content-root");class Mt extends Event{constructor(e,t){super(e,t)}get shadowRoot(){return this.target.shadowRoot}}const Lt=new t("shadow-root-builder"),Ut={set:[{a:Lt,is:function(e,t){const n=function(e,t){const n=e.shadowRoot;if(n)return n;if("attachShadow"in e)return e.attachShadow(t);return}(e.element,t);if(n)return n[Ce]=e,e.dispatchEvent(new Mt("wesib:shadowAttached",{bubbles:!0})),n;return}}]};class Nt{static get[he](){return Ut}}const zt={mode:"open"},Bt={componentDef:(e=zt)=>({perComponent:[{a:At,by:t=>t.get(Lt)(t,e)},{a:Oe,by:e=>e.get(At,{or:null})}],feature:{needs:Nt}})};function Vt(e){return t=>{ve.define(t,Bt.componentDef(e))}}class It extends a{constructor(e){super(e)}grow(e){let t;return e.seed((...e)=>t=function(e){return(t,n)=>{const s=(n,r)=>{const o=e[n];return o?G(o((e=r)=>s(n+1,e),r)):t(r)};return s(0,n)}}(e)),e.byDefault(()=>(e,n)=>t(e,n))||$t}}function $t(e,t){return e(t)}const Ft=new It("http-fetch-agent"),Ht={};const Qt=new t("http-fetch",{byDefault:ee((function(e){const t=e.get(se),n=e.get(Ft);return(e,t)=>n(s,new Request(e,t));function s(e){return A(n=>{const s=new b;let r;if("AbortController"in t){const o=new t.AbortController,{signal:i}=o;r=v(e=>{e===Ht&&o.abort()}),n.supply.whenOff(()=>r.off(Ht)).needs(r),s.on({supply:r,receive(e,t){n.receive(e,t)}});const a=e.signal;a&&(new _(a).on("abort").once(()=>o.abort()),a.aborted&&o.abort()),e=new Request(e,{signal:i})}else r=s.on(n);t.fetch(e).then(e=>{s.send(e),r.off()}).catch(e=>r.off(e))})}}))});class Gt extends Event{constructor(e,t){super(e,Object.assign(Object.assign({},t),{cancelable:!1})),this.when=t.when,this.to=t.to}}class Jt extends Event{constructor(e,t){super(e,Object.assign(Object.assign({},t),{cancelable:!0})),this.when=t.when,this.from=t.from,this.to=t.to}}class Kt extends Event{constructor(e,t){super(e,Object.assign(Object.assign({},t),{cancelable:!0})),this.from=t.from,this.to=t.to,this.reason=t.reason}get when(){return"stay"}}const Wt=new e("navigation");class Xt{static get[r](){return Wt}get[R](){return this.on}get[j](){return this.read}back(){this.go(-1)}forward(){this.go(1)}reload(){this.go()}}class Yt extends a{constructor(e){super(e)}grow(e){const{document:t}=e.context.get(se);return(t,s,r,o)=>{const i=e.byDefault(()=>n);return i?i(t,s,r,o):t(o)};function n(n,s,r,o){let i;return e.seed.once((...e)=>i=e),function e(o,a){const c=i[o];if(!c)return n(a);c(({url:n=a.url,title:s=a.title,data:r=a.data}=a)=>e(o+1,{url:new URL(String(n),t.baseURI),title:s,data:r,get visited(){return a.visited},get current(){return a.current},get:e=>a.get(e),put(e,t){a.put(e,t)}}),s,r,a)}(0,o)}}}const Zt=new Yt("navigation-agent"),en=Symbol("page-param");class tn{get[en](){return this}}class nn extends o{}const sn=new e("navigation-history",{byDefault:ee(e=>new rn(e))});class rn{constructor(e){this._context=e,this._entries=new Map,this._lastId=0;const t=e.get(se);this._document=t.document,this._location=t.location,this._history=t.history,this._uid=btoa(String(Math.random()))}static get[r](){return sn}init(){const{data:e}=an(this._history.state),t=this.newEntry({url:new URL(this._location.href),data:e,title:this._document.title});return this._entries.set(t.id,t),t.schedule(()=>{t.enter("init"),this._history.replaceState(this._historyState(t),"")}),t}newEntry(e){return new cn(this._context,++this._lastId,e)}open(e,t){const{page:{title:n="",url:s}}=e;this._history.pushState(this._historyState(e),n,s.href),this._enter("open",e,t)}_enter(e,t,n){const s=n.it;this._entries.set(t.id,t);try{for(let e=s.next;e;e=e.next)this._forget(e)}finally{t.prev=s,s.next=t,t.schedule(()=>{try{s.leave()}finally{t.enter(e)}}),n.it=t}}replace(e,t){const n=t.it,{page:{title:s="",url:r}}=e;this._history.replaceState(this._historyState(e),s,r.href),this._entries.set(e.id,e);const o=n.prev;o&&(e.prev=o,o.next=e),e.schedule(()=>{try{n.leave()}finally{try{this._forget(n)}finally{e.enter("replace")}}}),t.it=e}popState(e,t){const{state:n}=e;if(null==n)return null==this._history.state?this._changeHash(t):void 0;const s=t.it,{uid:r,data:o,id:i}=an(n);let a;const c=r===this._uid&&null!=i?this._entries.get(i):void 0;return c?a=c:(a=this.newEntry({url:new URL(this._location.href),data:o,title:this._document.title}),s.transfer(a,"return"),this._entries.set(a.id,a),this._history.replaceState(this._historyState(a),"")),a.schedule(()=>{try{s.leave()}finally{a.enter("return")}}),t.it=a,a}hashChange(e){if(null==this._history.state)return this._changeHash(e)}update(e,t){const n=e.it,s=new cn(this._context,++this._lastId,Object.assign(Object.assign({},n.page),{url:t}),n);return this._entries.set(s.id,s),this._history.replaceState(this._historyState(s),"",t.href),this._entries.delete(n.id),e.it=s}_changeHash(e){const t=e.it,n=this.newEntry({url:new URL(this._location.href),data:null,title:this._document.title});try{t.transfer(n,"enter")}finally{this._history.replaceState(this._historyState(n),""),this._enter("enter",n,e)}return n}_forget(e){this._entries.delete(e.id),e.forget()}_historyState({id:e,page:{data:t}}){return{[on]:{uid:this._uid,id:e,data:t}}}}const on="wesib:navigation:data";function an(e){return null==e||"object"!=typeof e?{data:e}:e[on]}class cn{constructor(e,t,n,s){this._context=e,this.id=t,this._status=0,this._update=i,this._params=s?s._params:new Map;const r=this;this.page={url:n.url,title:n.title,data:n.data,get visited(){return!!r._status},get current(){return 2===r._status},get:e=>r.get(e),put(e,t){r.put(e,t)}}}get(e){const t=this._params.get(e[en]);return t&&t.get()}put(e,t){const n=e[en],r=this._params.get(n);if(r)return r.put(t),r.get();const o=new s(this._context);const i=n.create(this.page,t,new class extends nn{constructor(){super(...arguments),this.get=o.newValues().get}});return this._params.set(n,i),this.page.current&&i.enter&&i.enter(this.page,"init"),i.get()}transfer(e,t){T(this._params.entries(),([n,s])=>{if(s.transfer){const r=s.transfer(e.page,t);r&&e._params.set(n,r)}})}stay(e){T(this._params.values(),t=>t.stay&&t.stay(e))}enter(e){this._status=2,T(this._params.values(),t=>t.enter&&t.enter(this.page,e))}leave(){this._status=1,T(this._params.values(),e=>e.leave&&e.leave())}forget(){T(this._params.values(),e=>e.forget&&e.forget()),this._params.clear()}schedule(e){this._update=e}apply(){const e=this._update;this._update=i,e()}}const un={set:{a:Xt,by:function(e){const t=e.get(se),{document:n,history:s}=t,r=new _(t),o=e.get(rn),a=e.get(Zt),u=r.on("wesib:enterPage"),h=r.on("wesib:leavePage"),l=r.on("wesib:stayOnPage"),d=W(u,h,l),f=c(o.init());f.read(e=>e.apply());const p=f.read.keep.thru(e=>e.page);let g=Promise.resolve();return r.on("popstate")(e=>{const t=o.popState(e,f);t&&r.dispatch(new Gt("wesib:enterPage",{when:null!=e.state?"return":"enter",to:t.page}))}),r.on("hashchange")(()=>{const e=o.hashChange(f);e&&r.dispatch(new Gt("wesib:enterPage",{when:"enter",to:e.page}))}),new class extends Xt{get length(){return s.length}get onEnter(){return u}get onLeave(){return h}get onStay(){return l}get on(){return d}get read(){return p}go(e){s.go(e)}open(e){return w("pre-open","open",e)}replace(e){return w("pre-replace","replace",e)}update(e){return o.update(f,m(e)).page}with(e,t){return function e(t){return{with:(n,s)=>e(ae(t,e=>e.put(n,s))),open:e=>w("pre-open","open",e,t),replace:e=>w("pre-replace","replace",e,t)}}(n=>n.put(e,t))}};function m(e){return"string"==typeof e?new URL(e,n.baseURI):e||f.it.page.url}function w(e,t,n,s=i){const c=function(e){return"string"==typeof e||e instanceof URL?{url:m(e)}:e.url instanceof URL?e:Object.assign(Object.assign({},e),{url:m(e.url)})}(n),u=g=g.then(h,h);return u;function h(){let n;try{const i=function(){if(g!==u)return l();const t=f.it,n=o.newEntry(c);t.transfer(n,e);const i=new Jt("wesib:leavePage",{when:e,from:t.page,to:n.page});if(s(n.page),!r.dispatch(i)||g!==u)return l(n);let h;if(a(e=>h=e,e,i.from,i.to),!h)return l(n);return n}();return i?(n=i,o[t](n,f),r.dispatch(new Gt("wesib:enterPage",{when:t,to:n.page})),n.page):i}catch(e){throw l(n,e),e}}function l(e,t){return e&&e.stay(f.it.page),r.dispatch(new Kt("wesib:stayOnPage",{from:f.it.page,to:c,reason:t})),null}}}}};function hn(e){let t;return n=>{const s=function(e){return new URL("",e.url).href}(n);if(t){if(t.url===s)return t.on;t.sup.off()}let r;const o=v().whenOff(()=>{t=void 0,r=void 0}),i=A(t=>{if(!r){const t=e(n),s=c(),i=t(e=>{s.it=e}).whenOff(e=>{null!=e&&o.off(e)});o.whenOff(e=>{i.off(e),s.done(e)}),r={on:s.read.thru_(e=>e?u(e):h()),num:0}}const s=r;return++s.num,s.on(t).needs(o).whenOff(e=>{--s.num||Promise.resolve().then(()=>{s.num||s!==r||o.off(e)})})});return t={url:s,on:i,sup:o},i}}class ln extends Error{}class dn{constructor(e,t){this._navigation=e,this._loader=t,this._map=new Map}get fragments(){const e=[];for(const t of this){if(!t.fragment)return[];e.push(t.fragment)}return e}[Symbol.iterator](){return L(U(this._map.values(),N))}handle(){const e=this,t=v();let n=q();return{get(){},put(t){e._add(t)},transfer(t){const n=e._transfer();return t.put(fn,n),n.handle()},enter(s,r){if("init"===r)return;n=v().needs(t);const o=A(t=>{const r=new b,o=r.on(t);return e._loader(s)(e=>r.send(e)).whenOff(e=>{void 0===e||e instanceof ln||r.send({ok:!1,page:s,error:e})}).needs(n),o}).share();T(e,({fragment:e,receiver:t})=>(function(e,t){return t?e.thru_(e=>e.ok?Object.assign(Object.assign({},e),{fragment:(null!=t.tag?e.document.getElementsByTagName(t.tag)[0]:e.document.getElementById(t.id))||void 0}):e):e})(o,e)({supply:v().needs(t.supply),receive(e,n){t.receive(e,n)}}))},leave(){n.off(new ln("page left"))},stay(){t.off(new ln("navigation cancelled"))},forget(){t.off(new ln("page forgotten"))}}}_add(e){const t=Object.assign(Object.assign({},e),{receiver:z(e.receiver)}),{supply:n}=t.receiver,s=this._map.get(n);s?s.push(t):(this._map.set(n,[t]),n.whenOff(()=>this._map.delete(n)))}_transfer(){const e=new dn(this._navigation,this._loader);for(const[t,n]of this._map.entries())e._map.set(t,[...n]);return e}}const fn=new class extends tn{create(e,t){return{get:()=>t,put:i}}},pn=new It("page-load-agent"),gn=new t("page-load-url",{byDefault:n(i)}),mn=new e("page-loader",{byDefault:ee((function(e){const t=e.get(se),n=e.get(Qt),s=e.get(gn),r=e.get(pn),o=new t.DOMParser;return e=>{const t=new URL(e.url.href);s(t);const i=new Request(t.href,{mode:"same-origin",credentials:"same-origin",headers:new Headers({Accept:"text/html"})});return A(e=>r(a,i)(e));function a(s){s=function(e,t){var n;const s=null===(n=e.get(fn))||void 0===n?void 0:n.fragments;if(!s||!s.length)return t;return new Request(t,{headers:{"Accept-Fragment":B(s,(e,t)=>(e?e+", ":"")+(null!=t.tag?"tag="+V(t.tag):"id="+V(t.id)),"")}})}(e,s);const r=new b,i=r.on.thru_((n,s)=>{if(!n.ok)return{ok:!1,page:e,response:n,error:n.status};try{return{ok:!0,page:e,response:n,document:wn(o,t,n,s)}}catch(t){return{ok:!1,page:e,response:n,error:t}}});return A(t=>{const{supply:o}=t;d({page:e}).once({supply:v().needs(o),receive(e,n){t.receive(e,n)}});const a=n(s)(e=>{i(t),e.text().then(t=>{r.send(e,t),o.needs(a)}).catch(e=>o.off(e))})})}}}))});function wn(e,t,n,s){const r=e.parseFromString(s,I(n.headers.get("Content-Type")||"text/html")[0].v);if(r.head){const e=r.head.querySelector("base");if(e)e.href=new URL(e.getAttribute("href"),t).href;else{const e=r.createElement("base");e.href=t.href,r.head.appendChild(e)}}return r}const yn=new class extends tn{create(e,t,n){const s=new dn(n.get(Xt),hn(n.get(mn))),r=s.handle();return e.put(fn,s),r.put(t),r}},_n=new e("page-cache-buster",{byDefault:ee(e=>new vn(e))}),bn="__wesib_app_rev__";class vn{constructor(e){const t=xn(e.get(se).document);if(t){const n=e.get(Xt);this.urlModifier=d(e=>e.searchParams.set(bn,t)),this.agent=d((e,s)=>e(new Request(s.url,s)).thru_(e=>{if(e.ok){const s=xn(e.document);if(s&&s!==t){const t=new URL(e.page.url.href);t.searchParams.set(bn,s),n.update(t),n.reload()}}return e}))}else this.urlModifier=d(),this.agent=d()}static get[r](){return _n}}function xn(e){var t;return null===(t=e.querySelector("meta[name=wesib-app-rev]"))||void 0===t?void 0:t.getAttribute("content")}function Sn(e,t,n,s=En){let r;"function"==typeof n?(s=n,r=null):r=n||null;const o=t.ownerDocument;if(e.nodeType!==Node.ELEMENT_NODE){const n=o.importNode(e,!1);return t.insertBefore(n,r),n}const i=e,a=o.createElement(i.tagName.toLowerCase());return i.getAttributeNames().forEach(e=>a.setAttribute(e,i.getAttribute(e))),s(e,a),t.insertBefore(a,r),a}function En(e,t){T(P(e.childNodes),e=>Sn(e,t))}function On(e,t){return x(g(t,e=>!!e.src),t=>[new URL(t.src,e.baseURI).href,t])}const Dn={needs:class{static get[he](){return un}},set:[{a:gn,by:e=>e.urlModifier,with:[vn]},{a:pn,by:e=>e.agent,with:[vn]},{a:pn,by:function(e){const t=e.get(se).document;return e=>e().thru_(e=>{if(e.ok){const n=new Set(x(On(t,P(t.scripts)),([e])=>e));T(g(On(e.document,P(e.document.querySelectorAll("script"))),([e])=>!n.has(e)),([e,s])=>{Sn(s,t.head,(t,n)=>n.src=e),n.add(e)})}return e})}},{a:pn,by:function(e){const t=e.get(se).document;return e=>e().thru_(e=>{if(!e.ok)return e;const n=e.document.querySelectorAll("link[rel=stylesheet]");if(!n.length)return e;let s=t.head,r=null;const o=t.querySelectorAll("link[rel=stylesheet]"),i=new Map,a=o.item(0);return a&&(s=a.parentNode,r=a,T(P(o),e=>i.set(new URL(e.href,t.baseURI).href,e))),T(P(n),e=>{const n=new URL(e.href,t.baseURI).href,o=i.get(n);o?($(i.keys())===n?(s=o.parentNode,r=o.nextSibling):s.insertBefore(o,r),i.delete(n)):Sn(e,s,r,(e,t)=>t.href=n)}),T(i.values(),e=>e.parentNode.removeChild(e)),e})}},{a:pn,by:function(e){const t=e.get(se).document;return e=>e().thru_(e=>{if(e.ok){const n=e.document.getElementsByTagName("title").item(0);n&&n.textContent&&(t.title=n.textContent)}return e})}}]};class Cn{static get[he](){return Dn}}const kn=new e("component-style-producer"),Rn=new F("component-styp-render"),jn=new J("https://wesib.github.io/ns/element-id-class","elic","element-id-class"),Tn=new e("unique-element-class",{byDefault:function(e){const t=e.get(re),n=e.get(ke),s=n.get(Be),r=`${s.name?O.name(s.name,t):"component"}#${++Pn}`,o=jn.name(t(jn),r,H);return n.element.classList.add(o),o}});let Pn=0;const qn=new e("component-style-producer:impl"),An=[{e:":host"}];class Mn{constructor(e,t=M){this._context=e,this._produce=t}static get[r](){return qn}produce(e,t={}){const n=this._context,s=n.get(At,{or:null});return this._produce(e,Object.assign(Object.assign({},t),{document:t.document||n.get(se).document,parent:t.parent||n.get(Oe),rootSelector:t.rootSelector||(s?An:[]),schedule:t.schedule||function(){const e=n.get(Rt);return t=>e.newSchedule().schedule(t)}(),nsAlias:t.nsAlias||n.get(re),render:function(){const{render:e}=t,r=new ie(e).add(...n.get(Rn));s||r.add((o=n.get(Tn),{order:-100,render(e,t){e.render(t,{selector:[{c:[o]},...e.selector]})}}));var o;return r.value}()}))}}const Ln={needs:Pt,perComponent:[{as:Mn},{a:kn,by:e=>(t,n)=>e.produce(t,n),with:[Mn]}]};class Un{static get[he](){return Ln}}const Nn={produce(e,t,n){const s=D(t),r=n&&n.offline,o=e.get(kn);let a,c=q();const u=v(e=>{a=i,c.off(e)});switch(a=()=>{c=o(s,n).needs(u)},r){case"always":e.whenReady(a);break;case!1:e.whenOn(e=>{a(),c.needs(e)});break;default:e.whenOn.once(a)}return e.whenDestroyed(e=>u.off(e)),u}};function zn(e){return(t,n)=>{const s=t.constructor;ve.define(s,{define(t){t.onComponent(t=>{t.whenReady(s=>{const r=s[n];Nn.produce(t,"function"==typeof r?r.bind(s):r,e)})})},feature:{needs:[Un]}})}}const Bn=new e("theme");class Vn{static get[r](){return Bn}ref(e){return e(this.root)}}const In=new e("theme-factory");class $n{static get[r](){return In}}const Fn=new class extends C{constructor(){super("theme-style")}grow(e){const t=new Map;return e.seed.forEach(e=>{let n,s,r;"function"==typeof e?(n=s=e,r=!0):(n=e.style,s=e.provide.bind(e),r=!1);const o=t.get(n);if(o){const[e,i]=o;t.set(n,[r?Hn(s,e):Hn(e,s),r||i])}else t.set(n,[s,r])}),t.size?n:e.byDefault(()=>n);function n(e){const n=t.get(e);if(!n)return e;const[s,r]=n;return r?s:Hn(e,s)}}};function Hn(e,t){return n=>k(e(n),t(n))}class Qn extends Vn{constructor(e){super(),this._styles=e,this.root=Q(),this._rules=new Map}style(...e){const t=this;return D(...e.reduce((function(e,n){const s=t._rules.get(n);if(s)e.push(s);else{const s=t._styles(n)(t);t._rules.set(n,s),e.push(s)}return e}),[]))}}const Gn={needs:Un,set:[{a:$n,as:class extends $n{constructor(e){super(),this._styles=e}newTheme(){return new Qn(this._styles)}},with:[Fn]},{a:Vn,by:e=>e.newTheme(),with:[$n]}]};class Jn{static get[he](){return Gn}}class Kn{}const Wn=new e("component-node");class Xn extends y{get[R](){return this.onUpdate}get[j](){return this.read}}const Yn={childList:!0},Zn={childList:!0,subtree:!0};function es(e,t,n,s,{deep:r,all:o}){const i=new b,a=r?Zn:Yn;let c,h,d=new Set;"string"==typeof n?h=n:e.whenDefined(n).then(({elementDef:{name:t}})=>{if(t&&(h=O.name(t,e.get(re)),i.size)){const e=D();if(e.size){const t=[...g(x(e,e=>s(e)),ns)];t.length&&i.send(t,[])}}});const f=new(0,e.get(se).MutationObserver)((function(e){const t=[],n=[];e.forEach(e=>{T(g(x(P(e.removedNodes),k),ns),e=>n.push(e)),T(g(x(P(e.addedNodes),C),ns),e=>t.push(e))}),(t.length||n.length)&&i.send(t,n)}));let p;const m=A(e=>{const n=!i.size,s=i.on(e);return n&&(D(),f.observe(t,a)),v(e=>{s.off(e),i.size||f.disconnect()}).needs(s)}),w=l(m.thru(()=>p),()=>[p]),_=m.thru((e,t)=>u(y.of(e),y.of(t))),S=l(e=>{const t=new b;t.on(e),t.send(p,y.of([])),_(e)}),E=K(w).keep.thru($);o||t.addEventListener("wesib:component",e=>{const t=e.target;if(d.has(t)){const e=s(t);i.send([e],[e])}});return p=new class extends Xn{get onUpdate(){return m}get read(){return w}get track(){return S}get first(){return E}[Symbol.iterator](){return L(c||(c=g(x(i.size?d:D(),e=>s(e)),ns)))}};function D(){return c=void 0,d=function(){const e=h;if(!e)return new Set;if(r)return new Set(P(t.querySelectorAll(e)));return new Set(g(P(t.children),t=>t.matches(e)))}()}function C(e){if(ts(e))return h&&e.matches(h)&&!d.has(e)?(d.add(e),s(e)):void 0}function k(e){if(ts(e)&&d.delete(e))return s(e,!0)}}function ts(e){return e.nodeType===Node.ELEMENT_NODE}function ns(e){return null!=e}class ss{constructor(e,t){this._bs=e,this.element=t,this._emitters=new Map}get observer(){if(this._observer)return this._observer;const e=this._bs.get(se).MutationObserver;return this._observer=new e(e=>this._update(e))}observe(e,t){const n=this,s=this.observer,r=this._emitter(e),o=z(t),i=r.on({supply:v(()=>{this._emitters.delete(e),s.disconnect(),this._emitters.size?a():this._observer=void 0}).needs(o.supply),receive:(e,t,n)=>o.receive(e,t,n)});return s.disconnect(),a(),i;function a(){n._update(s.takeRecords()),s.observe(n.element,{attributes:!0,attributeOldValue:!0,attributeFilter:[...n._emitters.keys()]})}}_update(e){e.forEach(e=>{const t=e.attributeName,n=this._emitters.get(t);n&&n.send(this.element.getAttribute(t),e.oldValue)})}_emitter(e){const t=new b;return this._emitters.set(e,t),t}}class rs extends X{constructor(e,t){super(),this._observer=e,this._name=t,this._updates=new b;let n=q();this.on=A(e=>{this._updates.size||(n=this._observer.observe(t,(e,t)=>this._updates.send(e,t))),e.supply.needs(n),this._updates.on(e).whenOff(e=>{this._updates.size||n.off(e)})})}get it(){return this._observer.element.getAttribute(this._name)}set it(e){this._observer.element.setAttribute(this._name,e)}done(e){return this._updates.done(e),this}}class os{constructor(e,t){this._attrs=new Map,this._observer=new ss(e,t)}get(e){const t=this._attrs.get(e);if(t)return t;const n=new rs(this._observer,e);return this._attrs.set(e,n),n}}class is extends X{constructor(e,t){super(),this._element=e,this._key=t,this._updates=new b,this._supply=q()}get on(){return this._updates.on}bind(e){const t=e.get(Ot).track((n=this._key,[St,n]));var n;this._supply=t.onUpdate({supply:v().whenOff(e=>this._updates.done(e)),receive:(e,t,n,s)=>this._updates.send(n,s)})}get it(){return this._element[this._key]}set it(e){this._element[this._key]=e}done(e){return this._supply.off(e),this}}class as{constructor(e){this._element=e,this._props=new Map}bind(e){this._context=e,this._props.forEach(t=>t.bind(e))}get(e){const t=this._props.get(e);if(t)return t;const n=new is(this._element,e);return this._context&&n.bind(this._context),this._props.set(e,n),n}}const cs=Symbol("element-node");class us extends Kn{constructor(e,t){super(),this._bs=e,this.element=t,this._attrs=new os(e,t),this._props=new as(t),t[cs]=this;const n=t[Ce];n?this._bind(n):t.addEventListener("wesib:component",e=>this._bind(e.context))}get context(){return this.element[Ce]}get parent(){const e=this.element.parentElement;return null!=e?hs(this._bs,e):null}select(e,t){return function(e,t,n,s={}){const r=e.get(Pe);if(s.all)return es(e,t,n,(t,n)=>hs(e,t,n),s);return es(e,t,n,(t,n)=>{if(r(t))return hs(e,t,n)},s)}(this._bs,this.element,e,t)}attribute(e){return this._attrs.get(e)}property(e){return this._props.get(e)}_bind(e){this._props.bind(e)}}function hs(e,t,n){const s=t[cs];return n||s?s:new us(e,t)}const ls={needs:Ct,perComponent:{a:Wn,by:e=>hs(e.get(Z),e.element)}};class ds{static get[he](){return ls}}export{xt as A,se as B,xe as C,re as D,pe as F,Xt as N,zn as P,qt as R,Vn as T,Wn as a,Z as b,ds as c,Cn as d,Jn as e,ft as f,Vt as g,En as i,yn as p};
//# sourceMappingURL=wesib.3f4b5cdb.module.js.map
