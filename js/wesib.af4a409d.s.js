System.register(["./lib.84fe121b.s.js"],(function(e){"use strict";var t,n,r,u,i,o,a,s,c,f,l,h,v,d,p,y,g,m,w,b,k,_,x,S,O,R,D,C,E,A,j,P,T,q,M,U,L,N,z,B,I,V,F,H,Q,G,J,K,W,X,Y,Z,$,ee,te,ne,re,ue,ie,oe,ae,se,ce,fe,le;return{setters:[function(e){t=e.S,n=e._,r=e.a,u=e.F,i=e.v,o=e.b,a=e.c,s=e.d,c=e.e,f=e.E,l=e.t,h=e.n,v=e.f,d=e.C,p=e.g,y=e.h,g=e.i,m=e.j,w=e.k,b=e.l,k=e.m,_=e.o,x=e.p,S=e.q,O=e.r,R=e.s,D=e.u,C=e.w,E=e.x,A=e.y,j=e.z,P=e.A,T=e.B,q=e.D,M=e.G,U=e.H,L=e.I,N=e.J,z=e.K,B=e.L,I=e.M,V=e.N,F=e.O,H=e.P,Q=e.Q,G=e.R,J=e.T,K=e.U,W=e.V,X=e.W,Y=e.X,Z=e.Y,$=e.Z,ee=e.$,te=e.a0,ne=e.a1,re=e.a2,ue=e.a3,ie=e.a4,oe=e.a5,ae=e.a6,se=e.a7,ce=e.a8,fe=e.a9,le=e.aa}],execute:function(){e({A:function(e){return function(t,n,r){var u=function(e,t,n){var r,u;if("string"==typeof n)u=qt(r=n);else{if(n&&n.name)r=n.name;else{if("string"!=typeof t)throw new TypeError("Attribute name is required, as property key is not a string: "+"".concat(e.constructor.name,".").concat(t.toString()));r=t}u=qt(r,n&&n.updateState)}return{name:r,updateState:u}}(t,n,e),i=u.name,o=u.updateState,a=t.constructor;Ce.define(a,{needs:Bt}),Ue.define(a,{define:function(e){e.get(Ut)(i,o)}});var s={get:function(){return Ve.of(this).element.getAttribute(i)},set:function(e){Ve.of(this).element.setAttribute(i,e)}};if(null!=r)return s;Object.defineProperty(t,n,s)}},C:function(e){return function(t){return Ue.define(t,"string"==typeof e?{name:e}:e)}},F:function(e){return function(t){return Ce.define(t,e)}},P:function(e){return function(t,n){var r=t.constructor;Ue.define(r,{define:function(t){t.onComponent((function(t){t.whenReady((function(r){var u=r.component,i=u[n];or.produce(t,"function"==typeof i?i.bind(u):i,e)}))}))},feature:{needs:[ir]}})}},R:function(e){return function(t,n){var r=t.constructor;Ue.define(r,{define:function(t){t.onComponent((function(t){t.whenReady((function(){var r=t.component,u=r[n].bind(r);Kt.render(t,u,e)}))}))},feature:{needs:[Qt,Xt]}})}},g:function(){for(var e=function(e){var t=l(0),r=e.values,u=new(function(i){function f(){var n;a(this,f),(n=s(this,c(f).call(this))).get=r.get;var u=t.read.thru((function(e){return e?h(k(n)):v()}));return n.whenReady=u.once,e.provide({a:me,by:P}),e.provide({a:ve,is:k(n)}),n}return n(f,i),o(f,[{key:"whenDefined",value:function(e){var t=this;return regeneratorRuntime.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,regeneratorRuntime.awrap(new Promise((function(e){return t.whenReady(e)})));case 2:return n.next=4,regeneratorRuntime.awrap(this.get(Ze).whenDefined(e));case 4:return n.abrupt("return",Xe(e));case 5:case"end":return n.stop()}}),null,this)}},{key:"load",value:function(e){var t,r=this,i=S((function(t){var n=u.get(Pt).request(e),i=l({status:{feature:e,ready:!1}});r.get(wt.of(e))({supply:t.supply,receive:function(e,t){var n=t;i.it={status:{feature:n.request.feature,ready:n.ready},down:n.down},n.ready||n.init().then((function(){i.it={status:{feature:n.request.feature,ready:!0},down:n.down}}))}}).whenOff((function(){n.unuse()})),i.read(t)})).share(),f=i((function(e){var n=e.down;return t=n})),h=i.keep.thru((function(e){return e.status})).tillOff(f);return new(function(e){function r(){return a(this,r),s(this,c(r).apply(this,arguments))}return n(r,e),o(r,[{key:"dismiss",value:function(e){return f.off(e),t}},{key:"read",get:function(){return h}},{key:"down",get:function(){return t}}]),r}(Pe))}}]),f}(ve));return{bootstrapContext:u,complete:function(){t.it=1}}}(it.create()),t=e.bootstrapContext,r=e.complete,u=arguments.length,i=new Array(u),f=0;f<u;f++)i[f]=arguments[f];var d=1===i.length?i[0]:(p=i,Ce.define((function e(){a(this,e)}),{needs:p}));var p;return t.get(Pt).request(d),t.get(wt.of(d))((function(e){e.init().then(r)})),t},h:function(e){return function(t){Ue.define(t,on.componentDef(e))}},i:Fn});var he=new t("bootstrap-context"),ve=e("b",function(e){function t(){return a(this,t),s(this,c(t).apply(this,arguments))}return n(t,e),o(t,null,[{key:d,get:function(){return he}}]),t}(p));function de(e){return function(t,n){var r=t.get(ve);return t===r?e(r,n):r.get(n)}}var pe=new t("component-factory"),ye=function(){function e(){a(this,e)}return o(e,[{key:"connectTo",value:function(e){var t=this.mountTo(e);return t.connected=!0,t}}],[{key:d,get:function(){return pe}}]),e}(),ge=e("B",new t("window",{byDefault:function(){return window}})),me=(new t("bootstrap-root",{byDefault:function(e){return e.get(ge).document.body}}),e("D",new t("default-namespace-aliaser")));function we(e){return Array.isArray(e)}var be=function(e){function t(e){var n;return a(this,t),(n=s(this,c(t).call(this))).items=null==e?new Set:we(e)?new Set(e):new Set([e]),n}return n(t,e),o(t,[{key:Symbol.iterator,value:function(){return this.items[Symbol.iterator]()}},{key:"add",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach((function(t){return e.items.add(t)})),this}},{key:"merge",value:function(e){return null==e?this:we(e)?this.add.apply(this,C(e)):this.add(e)}},{key:"value",get:function(){switch(this.items.size){case 0:return;case 1:return this.items[Symbol.iterator]().next().value;default:return C(this.items)}}},{key:"size",get:function(){return this.items.size}}]),t}(q);function ke(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0},n=Object.getPrototypeOf(e.prototype);if(null!=n){var r=n.constructor;return t(r)?r:ke(r,t)}}function _e(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e,t){return t};return e?t?function(){for(var r=arguments.length,u=new Array(r),i=0;i<r;i++)u[i]=arguments[i];return n(e.apply(this,u),t.apply(this,u))}:e:t}function xe(e){return e.nodeType===Node.ELEMENT_NODE}var Se=function(){function e(t){a(this,e),this.symbol=t}return o(e,[{key:"own",value:function(e){return e.hasOwnProperty(this.symbol)?e[this.symbol]:void 0}},{key:"of",value:function(e){var t=this.own(e),n=ke(e),r=n&&this.of(n);return t?r?this.merge(r,t):t:r}},{key:"define",value:function(e){for(var t=this.own(e),n=arguments.length,r=new Array(n>1?n-1:0),u=1;u<n;u++)r[u-1]=arguments[u];var i=t?this.merge.apply(this,[t].concat(r)):this.merge.apply(this,r);return Object.defineProperty(e,this.symbol,{configurable:!0,value:i}),e}}]),e}(),Oe=function(){function e(){var t=this;a(this,e),this.promise=new Promise((function(e,n){t._resolve=e,t._reject=n}))}return o(e,[{key:"resolve",value:function(e){this._resolve(e)}},{key:"reject",value:function(e){this._reject(e)}}]),e}(),Re=Symbol("feature-def"),De=new(function(e){function t(){return a(this,t),s(this,c(t).call(this,Re))}return n(t,e),o(t,[{key:"merge",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((function(e,t){return{needs:new be(e.needs).merge(t.needs).value,has:new be(e.has).merge(t.has).value,setup:_e(e.setup,t.setup),init:_e(e.init,t.init)}}),{})}}]),t}(Se)),Ce={of:function(e){return De.of(e)||{}},merge:function(){return De.merge.apply(De,arguments)},define:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return De.define.apply(De,[e].concat(n))}};var Ee=new t("feature-context"),Ae=function(e){function t(){return a(this,t),s(this,c(t).apply(this,arguments))}return n(t,e),o(t,[{key:"whenDefined",value:function(e){return this.get(ve).whenDefined(e)}},{key:"load",value:function(e){return this.get(ve).load(e)}}],[{key:d,get:function(){return Ee}}]),t}(ve),je=function(e){function t(e){var n;return a(this,t),(n=s(this,c(t).call(this,"Circular feature needs: "+e.reduce((function(e,t){var n=y(t,3),r=n[0],u=n[1],i=n[2];return(e||r.name)+" ".concat(u," ").concat(i.name)}),"")))).needs=e,n}return n(t,e),t}(r(Error)),Pe=function(){function e(){a(this,e)}return o(e,[{key:z,get:function(){return this.read}}]),e}(),Te=Symbol("component-def"),qe=new(function(e){function t(){return a(this,t),s(this,c(t).call(this,Te))}return n(t,e),o(t,[{key:"merge",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((function(e,t){return Object.assign(Object.assign(Object.assign({},e),t),{setup:_e(e.setup,t.setup),define:_e(e.define,t.define),feature:e.feature?t.feature?Ce.merge(e.feature,t.feature):e.feature:t.feature})}),{})}}]),t}(Se)),Me=Symbol("component-defined"),Ue={of:function(e){return qe.of(e)||{}},merge:function(){return qe.merge.apply(qe,arguments)},define:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var u=this.merge.apply(this,n);qe.define(e,u);var i=u.feature;return i&&Ce.define(e,i),Ce.define(e,{init:function(t){t.feature!==e||e.hasOwnProperty(Me)||(Object.defineProperty(e,Me,{value:1}),t.define(e))}}),e}};var Le=new t("component-context"),Ne=new t("component-event-dispatcher",{byDefault:function(){return{dispatch:function(e,t){return e.element.dispatchEvent(t)},on:function(e,t){return new M(e.element).on(t)}}}}),ze=new t("content-root",{byDefault:function(e){return e.get(Le).element}}),Be=new u("state-updater",{byDefault:i(g)}),Ie=Symbol("component-context"),Ve=function(e){function t(){var e;return a(this,t),(e=s(this,c(t).apply(this,arguments))).updateState=Fe.bind(k(e)),e}return n(t,e),o(t,[{key:"on",value:function(e){return this.get(Ne).on(this,e)}},{key:"dispatchEvent",value:function(e){this.get(he).get(Ne).dispatch(this,e)}},{key:"contentRoot",get:function(){return this.get(ze)}}],[{key:"of",value:function(e){var t=e[Ie];if(!t)throw TypeError("No component context found in ".concat(e));return t}},{key:d,get:function(){return Le}}]),t}(p);function Fe(e,t,n){this.get(Be)(e,t,n)}var He=function(e){function t(e,n){return a(this,t),s(this,c(t).call(this,e,n))}return n(t,e),o(t,[{key:"context",get:function(){return Ve.of(this.target)}}]),t}(r(Event)),Qe=function(){function e(){a(this,e)}return o(e,[{key:"component",get:function(){return this.context.component}},{key:"element",get:function(){return this.context.element}}]),e}(),Ge=new(function(e){function t(){return a(this,t),s(this,c(t).call(this,"element-adapter"))}return n(t,e),o(t,[{key:"grow",value:function(e){var t,n=function(e){return e[Ie]};return e.seed((function(){for(var r=arguments.length,u=new Array(r),i=0;i<r;i++)u[i]=arguments[i];var o=u.reduce((function(e,t){return function(n){return e(n)||t(n)}}),n);t=o!==n?o:e.byDefault((function(){return n}))||n})),function(e){return t(e)}}}]),t}(m)),Je=new u("element-observer",{byDefault:de((function(e){var t=e.get(Ge),r=function(e){function r(e){var n;return a(this,r),n=s(this,c(r).call(this,(function(r){r.forEach((function(e){U(L(e.removedNodes),(function(e){var t;return null===(t=function(e){var t;return null===(t=e[Ie])||void 0===t?void 0:t.mount}(e))||void 0===t?void 0:t.checkConnected()})),U(E(L(e.addedNodes),xe),(function(e){var n,r;return null===(r=null===(n=t(e))||void 0===n?void 0:n.mount)||void 0===r?void 0:r.checkConnected()}))})),e(r,k(n))})))}return n(r,e),r}(Ke);return function(e){return new r(e)}}))}),Ke=function(e){function t(){return a(this,t),s(this,c(t).apply(this,arguments))}return n(t,e),o(t,[{key:"observe",value:function(e,n){w(c(t.prototype),"observe",this).call(this,e,Object.assign(Object.assign({},n),{childList:!0}))}}],[{key:d,get:function(){return Je}}]),t}(r(MutationObserver));var We=Symbol("component-factory");function Xe(e){var t=e[We];if(!t)throw new TypeError("Component is not defined: ".concat(e));return t}var Ye=new t("custom-elements",{byDefault:function(e){var t=e.get(ge).customElements,r=e.get(me);return new(function(e){function u(){return a(this,u),s(this,c(u).apply(this,arguments))}return n(u,e),o(u,[{key:"define",value:function(e,n){if(B(e))t.define(I.name(e,r),n);else{var u=Xe(e).elementDef,i=u.name,o=u.extend;i?o&&o.name?t.define(I.name(i,r),n,{extends:o.name}):t.define(I.name(i,r),n):et(e).resolve(void 0)}}},{key:"whenDefined",value:function(e){if(B(e))return t.whenDefined(I.name(e,r));var n=Xe(e).elementDef.name;return n?t.whenDefined(I.name(n,r)):et(e).promise}}]),u}(Ze))}}),Ze=function(){function e(){a(this,e)}return o(e,null,[{key:d,get:function(){return Ye}}]),e}();var $e=Symbol("component-resolver");function et(e){return e[$e]||(e[$e]=new Oe)}var tt=new t("definition-context"),nt=new t("element-def",{byDefault:function(e){var t=e.get(tt).componentType,n=Ue.of(t),r=n.name,u=n.extend,i={get type(){return u&&u.type||e.get(ge).HTMLElement},get name(){return u&&u.name}};return{get name(){return r},get extend(){return i}}}}),rt=function(e){function t(){return a(this,t),s(this,c(t).apply(this,arguments))}return n(t,e),o(t,[{key:"elementDef",get:function(){return this.get(nt)}}],[{key:d,get:function(){return tt}}]),t}(p),ut=new t("bootstrap-context-registry"),it=function(e){function t(){var e;return a(this,t),(e=s(this,c(t).call(this))).provide({a:t,is:k(e)}),e.values=e.newValues(),e}return n(t,e),o(t,null,[{key:"create",value:function(){return new t}},{key:d,get:function(){return ut}}]),t}(b),ot=new t("component-context-registry",{byDefault:de((function(){return new at}))}),at=function(e){function t(e){return a(this,t),s(this,c(t).call(this,e))}return n(t,e),o(t,null,[{key:d,get:function(){return ot}}]),t}(b),st=new t("definition-context-registry",{byDefault:de((function(e){return new ct(e)}))}),ct=function(e){function t(e){return a(this,t),s(this,c(t).call(this,e))}return n(t,e),o(t,null,[{key:d,get:function(){return st}}]),t}(b);var ft=Symbol("post-def-setup");function lt(e){if(e.hasOwnProperty(ft))return e[ft];var t=l(),n=new f,r=t.read.thru((function(e){return e?h(e):v()})),u=x(r,n),i=ke(e,(function(e){return Te in e}));if(i){var o=lt(i);u((function(e){return o.send(e)}))}var a={on:u,send:function(e){n.send(e)},setup:function(e){t.it=e}};return Object.defineProperty(e,ft,{value:a}),a}var ht=new t("element-builder",{byDefault:de((function(e){var t=e.get(ct),r=e.get(at),u=new f,i=new f;return{definitions:u,components:i,buildElement:function(e){var i,p,y,m,b=Ue.of(e),_=new f,x=l(!1),S=x.read.thru((function(e){return e?h():v()}));function O(){return r.append(y)}var R=new(function(e){function t(){return a(this,t),s(this,c(t).apply(this,arguments))}return n(t,e),o(t,[{key:"mountTo",value:function(e){if(e[Ie])throw new Error("Element ".concat(e," already bound to component"));var t=d({definitionContext:m,onComponent:_,registry:O(),element:e,elementSuper:function(t){return e[t]},createMount:function(t){return new(function(r){function u(){return a(this,u),s(this,c(u).apply(this,arguments))}return n(u,r),o(u,[{key:"checkConnected",value:function(){var t=e,n=t.ownerDocument;return this.connected=null!=n&&n.contains(t)}},{key:"context",get:function(){return t}},{key:"connected",get:function(){return 3===dt(e).it},set:function(t){dt(e).it=t?3:2}}]),u}(Qe))}}).mount;return t.checkConnected(),pt(t.context),t}},{key:"componentType",get:function(){return m.componentType}},{key:"elementType",get:function(){return m.elementType}},{key:"elementDef",get:function(){return m.elementDef}}]),t}(ye));m=new(function(r){function u(){var n,r,i;a(this,u),n=s(this,c(u).call(this));var o=k(n);n.whenReady=S.thru((function(){return k(n)})).once;var f=new ct(t.seedIn(k(n)));f.provide({a:rt,is:k(n)}),f.provide({a:ye,is:R}),n.get=f.newValues().get,y=new at(f.seedIn(k(n)));var l={get componentType(){return e},get whenReady(){return o.whenReady},perDefinition:function(e){return f.provide(e)},perComponent:function(e){return y.provide(e)}};return null===(i=(r=b).setup)||void 0===i||i.call(r,l),lt(e).setup(l),n}return n(u,r),o(u,[{key:"perComponent",value:function(e){return y.provide(e)}},{key:"componentType",get:function(){return e}},{key:"onComponent",get:function(){return _.on}},{key:"elementType",get:function(){throw new Error("Custom element class is not constructed yet. Consider to use a `whenReady()` callback")}}]),u}(rt)),null===(p=(i=b).define)||void 0===p||p.call(i,m),u.send(m);var D=function(e,t,r){return function(u){function i(){var n;return a(this,i),n=s(this,c(i).call(this)),pt(d({definitionContext:e,onComponent:t,registry:r,element:k(n),createMount:g,elementSuper:function(e){return w(c(i.prototype),e,k(n))}})),n}return n(i,u),o(i,[{key:"connectedCallback",value:function(){dt(this).it=3}},{key:"disconnectedCallback",value:function(){dt(this).it=2}}]),i}(e.get(nt).extend.type)}(m,_,O());return Object.defineProperty(m,"elementType",{configurable:!0,enumerable:!0,value:D}),x.it=!0,R}};function d(e){var t=e.definitionContext,r=e.onComponent,u=e.registry,f=e.element,d=e.createMount,p=e.elementSuper,y=l(0),m=l();y.on(g).whenOff((function(e){return m.it=[e]}));var w,b=m.read.thru((function(e){return e?h(e[0]):v()})).once,x=y.read.thru((function(e){return 2===e?h():v()})),S=y.read.thru((function(e){if(3!==e)return v();var t=_();return x.once((function(){return t.off()})),h(t)})),O=u.newValues(),R=new(function(e){function r(){var e;a(this,r),(e=s(this,c(r).call(this))).get=O.get,e.elementSuper=p;var t=y.read.thru((function(t){return t?h(k(e)):v()}));return e.whenReady=t.once,e}return n(r,e),o(r,[{key:"destroy",value:function(e){y.done(e)}},{key:"componentType",get:function(){return t.componentType}},{key:"element",get:function(){return f}},{key:"component",get:function(){throw new Error("The component is not constructed yet. Consider to use a `whenReady()` callback")}},{key:"mount",get:function(){return w||(w=d(this))}},{key:"connected",get:function(){return 3===y.it}},{key:"whenOn",get:function(){return S}},{key:"whenOff",get:function(){return x}},{key:"whenDestroyed",get:function(){return b}}]),r}(Ve));R.whenDestroyed((function(){return function(e){var t=e.element,n=e.mount;n&&(n.connected=!1);var r=t.parentElement;r&&r.removeChild(t)}(R)})),u.provide({a:Ve,is:R}),Object.defineProperty(f,Ie,{value:R}),Object.defineProperty(f,vt,{writable:!0,value:y}),i.send(R),r.send(R);var D=function(e,t){var n=e.prototype,r=n[Ie];n[Ie]=t;try{var u=new e(t);return Object.defineProperty(u,Ie,{value:t}),u}finally{n[Ie]=r}}(t.componentType,R);return Object.defineProperty(R,"component",{configurable:!0,enumerable:!0,value:D}),y.it=1,R}}))});var vt=Symbol("component-status");function dt(e){return e[vt]}function pt(e){e.dispatchEvent(new He("wesib:component",{bubbles:!0}))}var yt=i(g);var gt=function(){function e(t){var n=this;a(this,e),this._context=t,this._definitionQueue=[],t.whenReady((function(){n._definitionQueue.forEach((function(e){return e()})),delete n._definitionQueue}))}return o(e,[{key:"define",value:function(e){var t=this;this._definitionQueue.push((function(){var n=t._context.get(ht).buildElement(e);e[We]=n,t.customElements.define(e,n.elementType)}))}},{key:"customElements",get:function(){return this._context.get(Ze)}}]),e}(),mt=Symbol("feature-key"),wt=function(e){function t(e){return a(this,t),s(this,c(t).call(this,"feature:".concat(e.name)))}return n(t,e),o(t,null,[{key:"of",value:function(e){var n=e;return n[mt]||(n[mt]=new t(e))}}]),o(t,[{key:"grow",value:function(e){return kt(e.context.get(ve),e.seed.keep.thru(bt))}}]),t}(m);function bt(){for(var e,t=!1,n=arguments.length,r=new Array(n),u=0;u<n;u++)r[u]=arguments[u];for(var i=0,o=r;i<o.length;i++){var a=o[i];switch(a[1]){case"is":t=!0,e||(e=a);break;case"has":e=a;break;case"needs":t=!0}}return t?e:void 0}function kt(e,t){return S((function(n){var r,u=O(),i=Promise.resolve("idle");return R({clause:t,deps:_t(e,t)}).dig_((function(t){var n=y(t.clause,1)[0],o=t.deps;if(!n)return O();var a=y(n,3),s=a[0],c=a[2];if(s.feature===r)return u;if(c!==(r=s.feature))return u=e.get(wt.of(r)).thru_((function(e){return e.to(i),i=e.stage,e}));var f=new St(e,s,o).to(i),l=O(f);return u=S((function(e){return l(e).whenOff((function(){i=f.unload()}))})).share()}))(n)})).keep.thru((n=null,function(e){return n===e?v():(n=e,e?h(e):h())}));var n}function _t(e,t){return t.keep.dig_((function(t){if(!t)return O();var n=y(t,1)[0].def,r=new be(n.needs);return r.size?D.apply(void 0,C(r.map((function(t){return e.get(wt.of(t))})))).keep.thru_(xt):O()}))}function xt(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return h.apply(void 0,C(E(j(t,(function(e){return e[0]})),A)))}var St=function(){function e(t,n,r){var u=this;a(this,e),this.bsContext=t,this.request=n,this.deps=r,this.state=l(!1),this.down=new Promise((function(e){return u._down=e})),this._stage=Promise.resolve(new Rt(this))}return o(e,[{key:"to",value:function(e){var t=this._stage;return this._stage=e.then((function(e){return t.then((function(t){return t[e]()}))})),this}},{key:"setup",value:function(){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(this._stage=this._stage.then((function(e){return e.setup()})));case 2:case"end":return e.stop()}}),null,this)}},{key:"init",value:function(){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(this._stage=this._stage.then((function(e){return e.init()})));case 2:case"end":return e.stop()}}),null,this)}},{key:"unload",value:function(){var e,t,n;return regeneratorRuntime.async((function(r){for(;;)switch(r.prev=r.next){case 0:return e=this._stage,delete this._stage,r.next=4,regeneratorRuntime.awrap(e);case 4:return t=r.sent,r.next=7,regeneratorRuntime.awrap(t.stop());case 7:return n=r.sent,this._down(),r.abrupt("return",n);case 10:case"end":return r.stop()}}),null,this)}},{key:"stage",get:function(){return this._stage.then((function(e){return e.after}))}},{key:"ready",get:function(){return this.state.it}}]),e}(),Ot=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return Promise.resolve()};a(this,e),this.loader=t,this._stop=n}return o(e,[{key:"idle",value:function(){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this);case 1:case"end":return e.stop()}}),null,this)}},{key:"stop",value:function(){var e=this;return this._stop().then((function(){return e.after}))}},{key:"perDep",value:function(e){var t=this.loader.deps;return Promise.all(t.map((function(t){return e(t)})))}}]),e}(),Rt=function(e){function t(){return a(this,t),s(this,c(t).apply(this,arguments))}return n(t,e),o(t,[{key:"setup",value:function(){var e,t,n,r,u,i,o,a,s;return regeneratorRuntime.async((function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,regeneratorRuntime.awrap(this.perDep((function(e){return e.setup()})));case 2:return n=this.loader,r=n.bsContext,u=n.request.def,i=Et(r,this.loader),o=y(i,2),a=o[0],s=o[1],null===(t=(e=u).setup)||void 0===t||t.call(e,a),c.abrupt("return",new Dt(this.loader,a,(function(){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",s.off());case 1:case"end":return e.stop()}}))})));case 6:case"end":return c.stop()}}),null,this)}},{key:"init",value:function(){return this.setup().then((function(e){return e.init()}))}},{key:"after",get:function(){return"idle"}}]),t}(Ot),Dt=function(e){function t(e,n,r){var u;return a(this,t),(u=s(this,c(t).call(this,e,r)))._context=n,u}return n(t,e),o(t,[{key:"setup",value:function(){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this);case 1:case"end":return e.stop()}}),null,this)}},{key:"init",value:function(){var e,t,n;return regeneratorRuntime.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,regeneratorRuntime.awrap(this.perDep((function(e){return e.init()})));case 2:return n=this.loader.request.def,null===(t=(e=n).init)||void 0===t||t.call(e,this._context),r.abrupt("return",new Ct(this));case 5:case"end":return r.stop()}}),null,this)}},{key:"after",get:function(){return"setup"}}]),t}(Ot),Ct=function(e){function t(e){var n;return a(this,t),n=s(this,c(t).call(this,e.loader,(function(){return e.stop()}))),e.loader.state.it=!0,n}return n(t,e),o(t,[{key:"after",get:function(){return"init"}}]),o(t,[{key:"setup",value:function(){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this);case 1:case"end":return e.stop()}}),null,this)}},{key:"init",value:function(){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this);case 1:case"end":return e.stop()}}),null,this)}}]),t}(Ot);function Et(e,t){var r,u,i,f=(r=[],u=function(e){var t=e();return r.push(t),t},{supply:_((function(){u=yt,U(L(r).reverse(),(function(e){return e()})),r.length=0})),add:function(e){return u(e)}}),d=e.get(ct),p=e.get(at),g=new b(e),m=e.get(ht),w=m.definitions.on.tillOff(f.supply),x=m.components.on.tillOff(f.supply);return[new(function(r){function u(){var n;a(this,u),(n=s(this,c(u).call(this))).get=g.newValues().get;var r=R({st:t.state,bs:l().by(e.whenReady)}).thru((function(e){var t=y(e.st,1)[0];return y(e.bs,1)[0]&&t?h(k(n)):v()}));return n.whenReady=r.once,g.provide({a:Ae,is:k(n)}),i=new gt(k(n)),n}return n(u,r),o(u,[{key:"provide",value:function(t){return f.add((function(){return e.get(it).provide(t)}))}},{key:"perDefinition",value:function(e){return f.add((function(){return d.provide(e)}))}},{key:"perComponent",value:function(e){return f.add((function(){return p.provide(e)}))}},{key:"setupDefinition",value:function(e){return function(e,t){var n=lt(e).on;return N((function(e){n({supply:e.supply.needs(t.supply),receive:function(n,r){var u=r.whenReady.tillOff(t.supply);e.receive(n,{get componentType(){return r.componentType},get whenReady(){return u},perDefinition:function(e){return t.add((function(){return r.perDefinition(e)}))},perComponent:function(e){return t.add((function(){return r.perComponent(e)}))}})}})}))}(e,f)}},{key:"define",value:function(e){i.define(e)}},{key:"feature",get:function(){return t.request.feature}},{key:"onDefinition",get:function(){return w}},{key:"onComponent",get:function(){return x}}]),u}(Ae)),f.supply]}var At=function(){function e(t,n,r){a(this,e),this._requester=t,this.feature=n,this._revoke=r,this._uses=0,this.def=Ce.of(n)}return o(e,[{key:"request",value:function(e){var t=this,n=this._requester,r=n.registry,u=[this,"is",this.feature];return this._revokeBy(r.provide({a:wt.of(this.feature),is:u})),new be(this.def.has).forEach((function(u){var i=[t,"has",u];t._revokeBy(r.provide({a:wt.of(u),is:i}));var o=n.request(u,[].concat(C(e),[i]));t._revokeBy((function(){return o.unuse()}))})),new be(this.def.needs).forEach((function(u){var i=[t,"needs",u],o=n.request(u,[].concat(C(e),[i]));t._revokeBy((function(){return o.unuse()})),t._revokeBy(r.provide({a:wt.of(u),is:i}))})),this._uses=1,this}},{key:"reuse",value:function(e){if(!this._uses)throw new je(e.map((function(e){var t=y(e,3);return[t[0].feature,t[1],t[2]]})));return++this._uses,this}},{key:"unuse",value:function(){--this._uses||this._revoke()}},{key:"_revokeBy",value:function(e){this._revoke=_e(e,this._revoke)}}]),e}(),jt=new t("feature-requester",{byDefault:de((function(e){return new Pt(e)}))}),Pt=function(){function e(t){a(this,e),this._map=new Map,this.registry=t.get(it)}return o(e,[{key:"request",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=this._map.get(e);if(r)return r.reuse(n);var u=new At(this,e,(function(){return t._map.delete(e)}));return this._map.set(e,u),u.request(n)}}],[{key:d,get:function(){return jt}}]),e}();var Tt=Symbol("attribute");function qt(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!1===t)return g;if(!0===t||"function"==typeof t){var n=function(e){return[Tt,e]}(e),r=!0===t?Mt:t;return function(e,t){r.call(this,n,e,t)}}return function(e,n){Ve.of(this).updateState(t,e,n)}}function Mt(e,t,n){Ve.of(this).updateState(e,t,n)}var Ut=new t("attribute-registrar"),Lt=new t("attribute-registry"),Nt=function(){function e(t){a(this,e),this._attrs={},this._MutationObserver=t.get(ge).MutationObserver}return o(e,[{key:"add",value:function(e,t){this._attrs[e]=_e(this._attrs[e],t)}},{key:"define",value:function(e){var t=this._attrs,n=Object.keys(t);n.length&&(Object.defineProperty(e,"observedAttributes",{configurable:!0,enumerable:!0,value:n}),Object.defineProperty(e.prototype,"attributeChangedCallback",{configurable:!0,enumerable:!0,value:function(e,n,r){t[e].call(Ve.of(this).component,r,n)}}))}},{key:"mount",value:function(e){var t=e.element,n=this._attrs,r=Object.keys(n);r.length&&new this._MutationObserver((function(e){return e.forEach((function(e){var r=e.attributeName;return n[r].call(Ve.of(t).component,t.getAttribute(r),e.oldValue)}))})).observe(t,{attributes:!0,attributeFilter:r,attributeOldValue:!0})}}],[{key:d,get:function(){return Lt}}]),e}(),zt={setup:function(e){e.perDefinition({as:Nt}),e.perDefinition({a:Ut,by:function(e){return function(t,n){return e.add(t,n)}},with:[Nt]}),e.onDefinition((function(e){e.whenReady((function(t){var n=t.elementType;return e.get(Nt).define(n)}))})),e.onComponent((function(e){var t=e.mount;t&&e.get(Nt).mount(t)}))}},Bt=function(){function e(){a(this,e)}return o(e,null,[{key:Re,get:function(){return zt}}]),e}();var It=Symbol("dom-property");var Vt=new t("component-state"),Ft=function(e){function t(){return a(this,t),s(this,c(t).apply(this,arguments))}return n(t,e),o(t,null,[{key:d,get:function(){return Vt}}]),t}(T),Ht={setup:function(e){e.perComponent({a:Ft,by:function(e){var t=new Ft;return e.whenDestroyed((function(e){return t.done(e)})),t}}),e.perComponent({a:Be,by:function(e){return e.update},with:[Ft]})}},Qt=function(){function e(){a(this,e)}return o(e,null,[{key:Re,get:function(){return Ht}}]),e}(),Gt=new t("render-scheduler"),Jt=function(){function e(){a(this,e)}return o(e,null,[{key:d,get:function(){return Gt}}]),e}(),Kt={render:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=e.get(Ft),u=e.get(Jt).newSchedule(),i=n.offline,o=!1,a=r.onUpdate((function(){i||e.connected?s():o=!1}));function s(){o=!0,u.schedule(c)}function c(){for(;;){var e=t();if(e===t||"function"!=typeof e)break;t=e}}i?s():e.whenOn((function(){o||s()})).whenOff((function(e){a.off(e),o=!0}))}},Wt={setup:function(e){e.provide({a:Jt,by:Yt,with:[ge]})}},Xt=e("e",function(){function e(){a(this,e)}return o(e,null,[{key:Re,get:function(){return Wt}}]),e}());function Yt(e){return new(function(t){function r(){return a(this,r),s(this,c(r).apply(this,arguments))}return n(r,t),o(r,[{key:"newSchedule",value:function(){var t=g;return new(function(){function n(){a(this,n)}return o(n,[{key:"schedule",value:function(n){var r=t;t=n,r===g&&e.requestAnimationFrame((function(){t(),t=g}))}}]),n}())}}]),r}(Jt))}var Zt=new t("shadow-content-root"),$t=function(e){function t(e,n){return a(this,t),s(this,c(t).call(this,e,n))}return n(t,e),o(t,[{key:"shadowRoot",get:function(){return this.target.shadowRoot}}]),t}(r(Event)),en=new u("shadow-root-builder"),tn={setup:function(e){e.provide({a:en,is:rn})}},nn=function(){function e(){a(this,e)}return o(e,null,[{key:Re,get:function(){return tn}}]),e}();function rn(e,t){var n=function(e,t){var n=e.shadowRoot;if(n)return n;if("attachShadow"in e)return e.attachShadow(t);return}(e.element,t);if(n)return n[Ie]=e,e.dispatchEvent(new $t("wesib:shadowAttached",{bubbles:!0})),n}var un={mode:"open"},on={componentDef:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:un;return{setup:function(t){t.perComponent({a:Zt,by:function(t){return t.get(en)(t,e)}}),t.perComponent({a:ze,by:function(e){return e.get(Zt,{or:null})}})},feature:{needs:nn}}}};var an=function(e){function t(e){return a(this,t),s(this,c(t).call(this,e))}return n(t,e),o(t,[{key:"grow",value:function(e){var t;return e.seed((function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=cn(n)})),e.byDefault((function(){return function(e,n){return t(e,n)}}))||sn}}]),t}(m);function sn(e,t){return e(t)}function cn(e){return function(t,n){return function n(r,u){var i=e[r];return i?ne(i((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u;return n(r+1,e)}),u)):t(u)}(0,n)}}var fn=new an("http-fetch-agent"),ln={};var hn=new u("http-fetch",{byDefault:de((function(e){var t=e.get(ge),n=e.get(fn);return function(e,t){return n(r,new Request(e,t))};function r(e){return N((function(n){var r,u=new f;if("AbortController"in t){var i=new t.AbortController,o=i.signal;r=_((function(e){e===ln&&i.abort()})),n.supply.whenOff((function(){return r.off(ln)})).needs(r),u.on({supply:r,receive:function(e,t){n.receive(e,t)}});var a=e.signal;a&&(new M(a).on("abort").once((function(){return i.abort()})),a.aborted&&i.abort()),e=new Request(e,{signal:o})}else r=u.on(n);t.fetch(e).then((function(e){u.send(e),r.off()})).catch((function(e){return r.off(e)}))}))}}))}),vn=function(e){function t(e,n){var r;return a(this,t),(r=s(this,c(t).call(this,e,Object.assign(Object.assign({},n),{cancelable:!1})))).when=n.when,r.to=n.to,r}return n(t,e),t}(r(Event)),dn=function(e){function t(e,n){var r;return a(this,t),(r=s(this,c(t).call(this,e,Object.assign(Object.assign({},n),{cancelable:!0})))).when=n.when,r.from=n.from,r.to=n.to,r}return n(t,e),t}(r(Event)),pn=function(e){function t(e,n){var r;return a(this,t),(r=s(this,c(t).call(this,e,Object.assign(Object.assign({},n),{cancelable:!0})))).from=n.from,r.to=n.to,r.reason=n.reason,r}return n(t,e),o(t,[{key:"when",get:function(){return"stay"}}]),t}(r(Event)),yn=new t("navigation"),gn=e("N",function(){function e(){a(this,e)}return o(e,[{key:"back",value:function(){this.go(-1)}},{key:"forward",value:function(){this.go(1)}},{key:"reload",value:function(){this.go()}},{key:G,get:function(){return this.on}},{key:z,get:function(){return this.read}}],[{key:d,get:function(){return yn}}]),e}()),mn=new(function(e){function t(e){return a(this,t),s(this,c(t).call(this,e))}return n(t,e),o(t,[{key:"grow",value:function(e){var t=e.context.get(ge).document;return function(t,r,u,i){var o=e.byDefault((function(){return n}));return o?o(t,r,u,i):t(i)};function n(n,r,u,i){var o;return e.seed.once((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return o=t})),function e(i,a){var s=o[i];if(!s)return n(a);s((function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a,r=n.url,u=void 0===r?a.url:r,o=n.title,s=void 0===o?a.title:o,c=n.data,f=void 0===c?a.data:c;return e(i+1,{url:new URL(String(u),t.baseURI),title:s,data:f,get visited(){return a.visited},get current(){return a.current},get:function(e){return a.get(e)},put:function(e,t){a.put(e,t)}})}),r,u,a)}(0,i)}}}]),t}(m))("navigation-agent"),wn=Symbol("page-param"),bn=function(){function e(){a(this,e)}return o(e,[{key:wn,get:function(){return this}}]),e}(),kn=function(e){function t(){return a(this,t),s(this,c(t).apply(this,arguments))}return n(t,e),t}(p),_n=new t("navigation-history",{byDefault:de((function(e){return new xn(e)}))}),xn=function(){function e(t){a(this,e),this._context=t,this._entries=new Map,this._lastId=0;var n=t.get(ge);this._document=n.document,this._location=n.location,this._history=n.history,this._uid=btoa(String(Math.random()))}return o(e,[{key:"init",value:function(){var e=this,t=On(this._history.state).data,n=this.newEntry({url:new URL(this._location.href),data:t,title:this._document.title});return this._entries.set(n.id,n),n.schedule((function(){n.enter("init"),e._history.replaceState(e._historyState(n),"")})),n}},{key:"newEntry",value:function(e){return new Rn(this._context,++this._lastId,e)}},{key:"open",value:function(e,t){var n=e.page,r=n.title,u=void 0===r?"":r,i=n.url;this._history.pushState(this._historyState(e),u,i.href),this._enter("open",e,t)}},{key:"_enter",value:function(e,t,n){var r=n.it;this._entries.set(t.id,t);try{for(var u=r.next;u;u=u.next)this._forget(u)}finally{t.prev=r,r.next=t,t.schedule((function(){try{r.leave()}finally{t.enter(e)}})),n.it=t}}},{key:"replace",value:function(e,t){var n=this,r=t.it,u=e.page,i=u.title,o=void 0===i?"":i,a=u.url;this._history.replaceState(this._historyState(e),o,a.href),this._entries.set(e.id,e);var s=r.prev;s&&(e.prev=s,s.next=e),e.schedule((function(){try{r.leave()}finally{try{n._forget(r)}finally{e.enter("replace")}}})),t.it=e}},{key:"popState",value:function(e,t){var n=e.state;if(null==n)return null==this._history.state?this._changeHash(t):void 0;var r,u=t.it,i=On(n),o=i.uid,a=i.data,s=i.id,c=o===this._uid&&null!=s?this._entries.get(s):void 0;return c?r=c:(r=this.newEntry({url:new URL(this._location.href),data:a,title:this._document.title}),u.transfer(r,"return"),this._entries.set(r.id,r),this._history.replaceState(this._historyState(r),"")),r.schedule((function(){try{u.leave()}finally{r.enter("return")}})),t.it=r,r}},{key:"hashChange",value:function(e){if(null==this._history.state)return this._changeHash(e)}},{key:"update",value:function(e,t){var n=e.it,r=new Rn(this._context,++this._lastId,Object.assign(Object.assign({},n.page),{url:t}),n);return this._entries.set(r.id,r),this._history.replaceState(this._historyState(r),"",t.href),this._entries.delete(n.id),e.it=r}},{key:"_changeHash",value:function(e){var t=e.it,n=this.newEntry({url:new URL(this._location.href),data:null,title:this._document.title});try{t.transfer(n,"enter")}finally{this._history.replaceState(this._historyState(n),""),this._enter("enter",n,e)}return n}},{key:"_forget",value:function(e){this._entries.delete(e.id),e.forget()}},{key:"_historyState",value:function(e){var t=e.id,n=e.page.data;return le({},Sn,{uid:this._uid,id:t,data:n})}}],[{key:d,get:function(){return _n}}]),e}(),Sn="wesib:navigation:data";function On(e){return null==e||"object"!==fe(e)?{data:e}:e[Sn]}var Rn=function(){function e(t,n,r,u){a(this,e),this._context=t,this.id=n,this._status=0,this._update=g,this._params=u?u._params:new Map;var i=this;this.page={url:r.url,title:r.title,data:r.data,get visited(){return!!i._status},get current(){return 2===i._status},get:function(e){return i.get(e)},put:function(e,t){i.put(e,t)}}}return o(e,[{key:"get",value:function(e){var t=this._params.get(e[wn]);return t&&t.get()}},{key:"put",value:function(e,t){var r=e[wn],u=this._params.get(r);if(u)return u.put(t),u.get();var i=new b(this._context),o=function(e){function t(){var e;return a(this,t),(e=s(this,c(t).apply(this,arguments))).get=i.newValues().get,e}return n(t,e),t}(kn),f=r.create(this.page,t,new o);return this._params.set(r,f),this.page.current&&f.enter&&f.enter(this.page,"init"),f.get()}},{key:"transfer",value:function(e,t){U(this._params.entries(),(function(n){var r=y(n,2),u=r[0],i=r[1];if(i.transfer){var o=i.transfer(e.page,t);o&&e._params.set(u,o)}}))}},{key:"stay",value:function(e){U(this._params.values(),(function(t){return t.stay&&t.stay(e)}))}},{key:"enter",value:function(e){var t=this;this._status=2,U(this._params.values(),(function(n){return n.enter&&n.enter(t.page,e)}))}},{key:"leave",value:function(){this._status=1,U(this._params.values(),(function(e){return e.leave&&e.leave()}))}},{key:"forget",value:function(){U(this._params.values(),(function(e){return e.forget&&e.forget()})),this._params.clear()}},{key:"schedule",value:function(e){this._update=e}},{key:"apply",value:function(){var e=this._update;this._update=g,e()}}]),e}();function Dn(e){var t=e.get(ge),r=t.document,u=t.history,i=new M(t),f=e.get(xn),h=e.get(mn),v=i.on("wesib:enterPage"),d=i.on("wesib:leavePage"),p=i.on("wesib:stayOnPage"),y=x(v,d,p),m=l(f.init());m.read((function(e){return e.apply()}));var w=m.read.keep.thru((function(e){return e.page})),b=Promise.resolve();return i.on("popstate")((function(e){var t=f.popState(e,m);t&&i.dispatch(new vn("wesib:enterPage",{when:null!=e.state?"return":"enter",to:t.page}))})),i.on("hashchange")((function(){var e=f.hashChange(m);e&&i.dispatch(new vn("wesib:enterPage",{when:"enter",to:e.page}))})),new(function(e){function t(){return a(this,t),s(this,c(t).apply(this,arguments))}return n(t,e),o(t,[{key:"go",value:function(e){u.go(e)}},{key:"open",value:function(e){return _("pre-open","open",e)}},{key:"replace",value:function(e){return _("pre-replace","replace",e)}},{key:"update",value:function(e){return f.update(m,k(e)).page}},{key:"with",value:function(e,t){return function e(t){return{with:function(n,r){return e(_e(t,(function(e){return e.put(n,r)})))},open:function(e){return _("pre-open","open",e,t)},replace:function(e){return _("pre-replace","replace",e,t)}}}((function(n){return n.put(e,t)}))}},{key:"length",get:function(){return u.length}},{key:"onEnter",get:function(){return v}},{key:"onLeave",get:function(){return d}},{key:"onStay",get:function(){return p}},{key:"on",get:function(){return y}},{key:"read",get:function(){return w}}]),t}(gn));function k(e){return"string"==typeof e?new URL(e,r.baseURI):e||m.it.page.url}function _(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g,u=function(e){return"string"==typeof e||e instanceof URL?{url:k(e)}:e.url instanceof URL?e:Object.assign(Object.assign({},e),{url:k(e.url)})}(n),o=b=b.then(a,a);return o;function a(){var n;try{var a=function(){if(b!==o)return s();var t=m.it,n=f.newEntry(u);t.transfer(n,e);var a,c=new dn("wesib:leavePage",{when:e,from:t.page,to:n.page});if(r(n.page),!i.dispatch(c)||b!==o)return s(n);if(h((function(e){return a=e}),e,c.from,c.to),!a)return s(n);return n}();return a?(n=a,f[t](n,m),i.dispatch(new vn("wesib:enterPage",{when:t,to:n.page})),n.page):a}catch(e){throw s(n,e),e}}function s(e,t){return e&&e.stay(m.it.page),i.dispatch(new pn("wesib:stayOnPage",{from:m.it.page,to:u,reason:t})),null}}}var Cn={setup:function(e){e.provide({a:gn,by:Dn})}},En=function(){function e(){a(this,e)}return o(e,null,[{key:Re,get:function(){return Cn}}]),e}();function An(e){var t;return function(n){var r,u=function(e){return new URL("",e.url).href}(n);if(t){if(t.url===u)return t.on;t.sup.off()}var i=_().whenOff((function(){t=void 0,r=void 0})),o=N((function(t){if(!r){var u=e(n),o=l(),a=u((function(e){o.it=e})).whenOff((function(e){null!=e&&i.off(e)}));i.whenOff((function(e){a.off(e),o.done(e)})),r={on:o.read.thru_((function(e){return e?h(e):v()})),num:0}}var s=r;return++s.num,s.on(t).needs(i).whenOff((function(e){--s.num||Promise.resolve().then((function(){s.num||s!==r||i.off(e)}))}))}));return t={url:u,on:o,sup:i},o}}var jn=function(e){function t(){return a(this,t),s(this,c(t).apply(this,arguments))}return n(t,e),t}(r(Error)),Pn=function(){function e(t,n){a(this,e),this._navigation=t,this._loader=n,this._map=new Map}return o(e,[{key:Symbol.iterator,value:function(){return J(K(this._map.values(),W))}},{key:"handle",value:function(){var e=this,t=_(),n=ee();return{get:function(){},put:function(t){e._add(t)},transfer:function(t){var n=e._transfer();return t.put(Tn,n),n.handle()},enter:function(r,u){if("init"!==u){n=_().needs(t);var i=N((function(t){var u=new f,i=u.on(t);return e._loader(r)((function(e){return u.send(e)})).whenOff((function(e){void 0===e||e instanceof jn||u.send({ok:!1,page:r,error:e})})).needs(n),i})).share();U(e,(function(e){var t=e.fragment,n=e.receiver;return function(e,t){return t?e.thru_((function(e){return e.ok?Object.assign(Object.assign({},e),{fragment:(null!=t.tag?e.document.getElementsByTagName(t.tag)[0]:e.document.getElementById(t.id))||void 0}):e})):e}(i,t)({supply:_().needs(n.supply),receive:function(e,t){n.receive(e,t)}})}))}},leave:function(){n.off(new jn("page left"))},stay:function(){t.off(new jn("navigation cancelled"))},forget:function(){t.off(new jn("page forgotten"))}}}},{key:"_add",value:function(e){var t=this,n=Object.assign(Object.assign({},e),{receiver:X(e.receiver)}),r=n.receiver.supply,u=this._map.get(r);u?u.push(n):(this._map.set(r,[n]),r.whenOff((function(){return t._map.delete(r)})))}},{key:"_transfer",value:function(){var t=new e(this._navigation,this._loader),n=!0,r=!1,u=void 0;try{for(var i,o=this._map.entries()[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var a=y(i.value,2),s=a[0],c=a[1];t._map.set(s,C(c))}}catch(e){r=!0,u=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw u}}return t}},{key:"fragments",get:function(){var e=[],t=!0,n=!1,r=void 0;try{for(var u,i=this[Symbol.iterator]();!(t=(u=i.next()).done);t=!0){var o=u.value;if(!o.fragment)return[];e.push(o.fragment)}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}return e}}]),e}();var Tn=new(function(e){function t(){return a(this,t),s(this,c(t).apply(this,arguments))}return n(t,e),o(t,[{key:"create",value:function(e,t){return{get:function(){return t},put:g}}}]),t}(bn)),qn=new an("page-load-agent"),Mn=new u("page-load-url",{byDefault:i(g)}),Un=new t("page-loader",{byDefault:de((function(e){var t=e.get(ge),n=e.get(hn),r=e.get(Mn),u=e.get(qn),i=new t.DOMParser;return function(e){var t=new URL(e.url.href);r(t);var o=new Request(t.href,{mode:"same-origin",credentials:"same-origin",headers:new Headers({Accept:"text/html"})});return N((function(e){return u(a,o)(e)}));function a(r){r=function(e,t){var n,r=null===(n=e.get(Tn))||void 0===n?void 0:n.fragments;if(!r||!r.length)return t;return new Request(t,{headers:{"Accept-Fragment":Y(r,(function(e,t){return(e?e+", ":"")+(null!=t.tag?"tag="+Z(t.tag):"id="+Z(t.id))}),"")}})}(e,r);var u=new f,o=u.on.thru_((function(n,r){if(!n.ok)return{ok:!1,page:e,response:n,error:n.status};try{return{ok:!0,page:e,response:n,document:Ln(i,t,n,r)}}catch(t){return{ok:!1,page:e,response:n,error:t}}}));return N((function(t){var i=t.supply;O({page:e}).once({supply:_().needs(i),receive:function(e,n){t.receive(e,n)}});var a=n(r)((function(e){o(t),e.text().then((function(t){u.send(e,t),i.needs(a)})).catch((function(e){return i.off(e)}))}))}))}}}))});function Ln(e,t,n,r){var u=e.parseFromString(r,$(n.headers.get("Content-Type")||"text/html")[0].v);if(u.head){var i=u.head.querySelector("base");if(i)i.href=new URL(i.getAttribute("href"),t).href;else{var o=u.createElement("base");o.href=t.href,u.head.appendChild(o)}}return u}e("p",new(function(e){function t(){return a(this,t),s(this,c(t).apply(this,arguments))}return n(t,e),o(t,[{key:"create",value:function(e,t,n){var r=new Pn(n.get(gn),An(n.get(Un))),u=r.handle();return e.put(Tn,r),u.put(t),u}}]),t}(bn)));var Nn=new t("page-cache-buster",{byDefault:de((function(e){return new Bn(e)}))}),zn="__wesib_app_rev__",Bn=function(){function e(t){a(this,e);var n=In(t.get(ge).document);if(n){var r=t.get(gn);this.urlModifier=O((function(e){return e.searchParams.set(zn,n)})),this.agent=O((function(e,t){return e(new Request(t.url,t)).thru_((function(e){if(e.ok){var t=In(e.document);if(t&&t!==n){var u=new URL(e.page.url.href);u.searchParams.set(zn,t),r.update(u),r.reload()}}return e}))}))}else this.urlModifier=O(),this.agent=O()}return o(e,null,[{key:d,get:function(){return Nn}}]),e}();function In(e){var t;return null===(t=e.querySelector("meta[name=wesib-app-rev]"))||void 0===t?void 0:t.getAttribute("content")}function Vn(e,t,n){var r,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Fn;"function"==typeof n?(u=n,r=null):r=n||null;var i=t.ownerDocument;if(xe(e)){var o=i.createElement(e.tagName.toLowerCase());return e.getAttributeNames().forEach((function(t){return o.setAttribute(t,e.getAttribute(t))})),u(e,o),t.insertBefore(o,r),o}var a=i.importNode(e,!1);return t.insertBefore(a,r),a}function Fn(e,t){U(L(e.childNodes),(function(e){return Vn(e,t)}))}function Hn(e){var t=e.get(ge).document;return function(e){return e().thru_((function(e){if(e.ok){var n=new Set(j(Qn(t,L(t.scripts)),(function(e){return y(e,1)[0]})));U(E(Qn(e.document,L(e.document.querySelectorAll("script"))),(function(e){var t=y(e,1)[0];return!n.has(t)})),(function(e){var r=y(e,2),u=r[0];Vn(r[1],t.head,(function(e,t){return t.src=u})),n.add(u)}))}return e}))}}function Qn(e,t){return j(E(t,(function(e){return!!e.src})),(function(t){return[new URL(t.src,e.baseURI).href,t]}))}function Gn(e){var t=e.get(ge).document;return function(e){return e().thru_((function(e){if(!e.ok)return e;var n=e.document.querySelectorAll("link[rel=stylesheet]");if(!n.length)return e;var r=t.head,u=null,i=t.querySelectorAll("link[rel=stylesheet]"),o=new Map,a=i.item(0);return a&&(r=a.parentNode,u=a,U(L(i),(function(e){return o.set(new URL(e.href,t.baseURI).href,e)}))),U(L(n),(function(e){var n=new URL(e.href,t.baseURI).href,i=o.get(n);i?(re(o.keys())===n?(r=i.parentNode,u=i.nextSibling):r.insertBefore(i,u),o.delete(n)):Vn(e,r,u,(function(e,t){return t.href=n}))})),U(o.values(),(function(e){return e.parentNode.removeChild(e)})),e}))}}function Jn(e){var t=e.get(ge).document;return function(e){return e().thru_((function(e){if(e.ok){var n=e.document.getElementsByTagName("title").item(0);n&&n.textContent&&(t.title=n.textContent)}return e}))}}var Kn={needs:En,setup:function(e){e.provide({a:Mn,by:function(e){return e.urlModifier},with:[Bn]}),e.provide({a:qn,by:function(e){return e.agent},with:[Bn]}),e.provide({a:qn,by:Hn}),e.provide({a:qn,by:Gn}),e.provide({a:qn,by:Jn})}},Wn=(e("d",function(){function e(){a(this,e)}return o(e,null,[{key:Re,get:function(){return Kn}}]),e}()),new t("component-style-producer")),Xn=new ue("component-styp-render"),Yn=new V("https://wesib.github.io/ns/element-id-class","elic","element-id-class"),Zn=new t("unique-element-class",{byDefault:function(e){var t=e.get(me),n=e.get(Ve),r=n.get(nt),u=r.name?I.name(r.name,t):"component",i="".concat(u,"#").concat(++$n),o=Yn.name(t(Yn),i,ie);return n.element.classList.add(o),o}}),$n=0;var er=new t("component-style-producer:impl"),tr=[{e:":host"}],nr=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ae;a(this,e),this._context=t,this._produce=n}return o(e,[{key:"produce",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this._context,r=n.get(Zt,{or:null});return this._produce(e,Object.assign(Object.assign({},t),{document:t.document||n.get(ge).document,parent:t.parent||n.get(ze),rootSelector:t.rootSelector||i(),schedule:t.schedule||u(),nsAlias:t.nsAlias||n.get(me),render:o()}));function u(){var e=n.get(Jt);return function(t){return e.newSchedule().schedule(t)}}function i(){return r?tr:[]}function o(){var e,u=t.render,i=(e=new be(u)).add.apply(e,C(n.get(Xn)));return r||i.add(rr(n.get(Zn))),i.value}}}],[{key:d,get:function(){return er}}]),e}();function rr(e){return{order:-100,render:function(t,n){t.render(n,{selector:[{c:[e]}].concat(C(t.selector))})}}}var ur={needs:Xt,setup:function(e){e.perComponent({as:nr}),e.perComponent({a:Wn,by:function(e){return function(t,n){return e.produce(t,n)}},with:[nr]})}},ir=function(){function e(){a(this,e)}return o(e,null,[{key:Re,get:function(){return ur}}]),e}(),or={produce:function(e,t,n){var r,u=F(t),i=n&&n.offline,o=e.get(Wn),a=ee(),s=_((function(e){r=g,a.off(e)}));switch(r=function(){a=o(u,n).needs(s)},i){case"always":e.whenReady(r);break;case!1:e.whenOn((function(e){r(),a.needs(e)}));break;default:e.whenOn.once(r)}return e.whenDestroyed((function(e){return s.off(e)})),s}};var ar={has:ir,needs:Xt,setup:function(e){e.perComponent({a:nr,by:function(e){return new nr(e,te)}}),e.perComponent({a:Wn,by:function(e){return function(t,n){return e.produce(t,n)}},with:[nr]})}},sr=(e("S",function(){function e(){a(this,e)}return o(e,null,[{key:Re,get:function(){return ar}}]),e}()),new t("theme")),cr=e("T",function(){function e(){a(this,e)}return o(e,[{key:"ref",value:function(e){return e(this.root)}}],[{key:d,get:function(){return sr}}]),e}()),fr=new t("theme-factory"),lr=function(){function e(){a(this,e)}return o(e,null,[{key:d,get:function(){return fr}}]),e}(),hr=new(function(e){function t(){return a(this,t),s(this,c(t).call(this,"theme-style"))}return n(t,e),o(t,[{key:"grow",value:function(e){var t=new Map;return e.seed.forEach((function(e){var n,r,u;"function"==typeof e?(n=r=e,u=!0):(n=e.style,r=e.provide.bind(e),u=!1);var i=t.get(n);if(i){var o=y(i,2),a=o[0],s=o[1];t.set(n,[u?vr(r,a):vr(a,r),u||s])}else t.set(n,[r,u])})),t.size?n:e.byDefault((function(){return n}));function n(e){var n=t.get(e);if(!n)return e;var r=y(n,2),u=r[0];return r[1]?u:vr(e,u)}}}]),t}(Q));function vr(e,t){return function(n){return H(e(n),t(n))}}var dr=function(e){function t(e){var n;return a(this,t),(n=s(this,c(t).call(this)))._styles=e,n.root=oe(),n._rules=new Map,n}return n(t,e),o(t,[{key:"style",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return F.apply(void 0,C(n.reduce(u,[])));function u(t,n){var r=e._rules.get(n);if(r)t.push(r);else{var u=e._styles(n)(e);e._rules.set(n,u),t.push(u)}return t}}}]),t}(cr),pr=function(e){function t(e){var n;return a(this,t),(n=s(this,c(t).call(this)))._styles=e,n}return n(t,e),o(t,[{key:"newTheme",value:function(){return new dr(this._styles)}}]),t}(lr),yr={needs:ir,setup:function(e){e.provide({a:lr,as:pr,with:[hr]}),e.provide({a:cr,by:function(e){return e.newTheme()},with:[lr]})}},gr=(e("f",function(){function e(){a(this,e)}return o(e,null,[{key:Re,get:function(){return yr}}]),e}()),function e(){a(this,e)}),mr=e("a",new t("component-node")),wr=function(e){function t(){return a(this,t),s(this,c(t).apply(this,arguments))}return n(t,e),o(t,[{key:G,get:function(){return this.onUpdate}},{key:z,get:function(){return this.read}}]),t}(q),br={subtree:!0};function kr(e,t,r,u,i){var l,v,d=i.deep,p=i.all,y=new f,g=d?br:void 0,m=new Set;"string"==typeof r?v=r:e.whenDefined(r).then((function(t){var n=t.elementDef.name;if(l=void 0,n&&(v=I.name(n,e.get(me)),y.size)){var r=P();if(r.size){var i=C(E(j(r,(function(e){return u(e)})),A));i.length&&y.send(i,[])}}}));var w,b=e.get(Ke)((function(e){var t=[],n=[];e.forEach((function(e){U(E(j(L(e.removedNodes),M),A),(function(e){return n.push(e)})),U(E(j(L(e.addedNodes),T),A),(function(e){return t.push(e)}))})),(t.length||n.length)&&y.send(t,n)})),k=N((function(e){var n=!y.size,r=y.on(e);return n&&(P(),b.observe(t,g)),_((function(e){r.off(e),y.size||b.disconnect()})).needs(r)})),x=S(k.thru((function(){return w})),(function(){return[w]})),O=k.thru((function(e,t){return h(q.of(e),q.of(t))})),R=S((function(e){var t=new f;t.on(e),t.send(w,q.of([])),O(e)})),D=se(x).keep.thru(re);return p||t.addEventListener("wesib:component",(function(e){var t=e.target;if(m.has(t)){var n=u(t);y.send([n],[])}})),w=new(function(e){function t(){return a(this,t),s(this,c(t).apply(this,arguments))}return n(t,e),o(t,[{key:Symbol.iterator,value:function(){return J(l||(l=E(j(y.size?m:P(),(function(e){return u(e)})),A)))}},{key:"onUpdate",get:function(){return k}},{key:"read",get:function(){return x}},{key:"track",get:function(){return R}},{key:"first",get:function(){return D}}]),t}(wr));function P(){return l=void 0,m=function(){var e=v;if(!e)return new Set;if(d)return new Set(L(t.querySelectorAll(e)));return new Set(E(L(t.children),(function(t){return t.matches(e)})))}()}function T(e){if(xe(e))return v&&e.matches(v)&&!m.has(e)?(m.add(e),u(e)):void 0}function M(e){if(xe(e)&&m.delete(e))return u(e,!0)}}var _r=function(){function e(t,n){a(this,e),this._bs=t,this.element=n,this._emitters=new Map}return o(e,[{key:"observe",value:function(e,t){var n=this,r=this,u=this.observer,i=this._emitter(e),o=X(t),a=i.on({supply:_((function(){n._emitters.delete(e),u.disconnect(),n._emitters.size?s():n._observer=void 0})).needs(o.supply),receive:function(e,t,n){return o.receive(e,t,n)}});return u.disconnect(),s(),a;function s(){r._update(u.takeRecords()),u.observe(r.element,{attributes:!0,attributeOldValue:!0,attributeFilter:C(r._emitters.keys())})}}},{key:"_update",value:function(e){var t=this;e.forEach((function(e){var n=e.attributeName,r=t._emitters.get(n);r&&r.send(t.element.getAttribute(n),e.oldValue)}))}},{key:"_emitter",value:function(e){var t=new f;return this._emitters.set(e,t),t}},{key:"observer",get:function(){var e=this;if(this._observer)return this._observer;var t=this._bs.get(ge).MutationObserver;return this._observer=new t((function(t){return e._update(t)}))}}]),e}(),xr=function(e){function t(e,n){var r;a(this,t),(r=s(this,c(t).call(this)))._observer=e,r._name=n,r._updates=new f;var u=ee();return r.on=N((function(e){r._updates.size||(u=r._observer.observe(n,(function(e,t){return r._updates.send(e,t)}))),e.supply.needs(u),r._updates.on(e).whenOff((function(e){r._updates.size||u.off(e)}))})),r}return n(t,e),o(t,[{key:"done",value:function(e){return this._updates.done(e),this}},{key:"it",get:function(){return this._observer.element.getAttribute(this._name)},set:function(e){this._observer.element.setAttribute(this._name,e)}}]),t}(ce),Sr=function(){function e(t,n){a(this,e),this._attrs=new Map,this._observer=new _r(t,n)}return o(e,[{key:"get",value:function(e){var t=this._attrs.get(e);if(t)return t;var n=new xr(this._observer,e);return this._attrs.set(e,n),n}}]),e}(),Or=function(e){function t(e,n){var r;return a(this,t),(r=s(this,c(t).call(this)))._element=e,r._key=n,r._updates=new f,r._supply=ee(),r}return n(t,e),o(t,[{key:"bind",value:function(e){var t,n=this,r=e.get(Ft).track((t=this._key,[It,t]));this._supply=r.onUpdate({supply:_().whenOff((function(e){return n._updates.done(e)})),receive:function(e,t,r,u){return n._updates.send(r,u)}})}},{key:"done",value:function(e){return this._supply.off(e),this}},{key:"on",get:function(){return this._updates.on}},{key:"it",get:function(){return this._element[this._key]},set:function(e){this._element[this._key]=e}}]),t}(ce),Rr=function(){function e(t){a(this,e),this._element=t,this._props=new Map}return o(e,[{key:"bind",value:function(e){this._context=e,this._props.forEach((function(t){return t.bind(e)}))}},{key:"get",value:function(e){var t=this._props.get(e);if(t)return t;var n=new Or(this._element,e);return this._context&&n.bind(this._context),this._props.set(e,n),n}}]),e}(),Dr=Symbol("element-node"),Cr=function(e){function t(e,n){var r;a(this,t),(r=s(this,c(t).call(this)))._bs=e,r.element=n,r._attrs=new Sr(e,n),r._props=new Rr(n),n[Dr]=k(r);var u=n[Ie];return u?r._bind(u):n.addEventListener("wesib:component",(function(e){return r._bind(e.context)})),r}return n(t,e),o(t,[{key:"select",value:function(e,t){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},u=e.get(Ge);if(r.all)return kr(e,t,n,(function(t,n){return Er(e,t,n)}),r);return kr(e,t,n,(function(t,n){if(u(t))return Er(e,t,n)}),r)}(this._bs,this.element,e,t)}},{key:"attribute",value:function(e){return this._attrs.get(e)}},{key:"property",value:function(e){return this._props.get(e)}},{key:"_bind",value:function(e){this._props.bind(e)}},{key:"context",get:function(){return this.element[Ie]}},{key:"parent",get:function(){var e=this.element.parentElement;return null!=e?Er(this._bs,e):null}}]),t}(gr);function Er(e,t,n){var r=t[Dr];return n||r?r:new Cr(e,t)}var Ar={needs:Qt,setup:function(e){e.perComponent({a:mr,by:function(e){return Er(e.get(ve),e.element)}})}};e("c",function(){function e(){a(this,e)}return o(e,null,[{key:Re,get:function(){return Ar}}]),e}())}}}));
//# sourceMappingURL=wesib.af4a409d.s.js.map
